"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[858],{71879:function(Si,Xe,m){m.r(Xe),m.d(Xe,{default:function(){return wi}});var Zt=m(12444),I=m.n(Zt),Ht=m(72004),A=m.n(Ht),Pt=m(25098),w=m.n(Pt),Bt=m(31996),H=m.n(Bt),Wt=m(26037),P=m.n(Wt),Yt=m(9783),b=m.n(Yt),z=m(67294),qe=m(9361),$t=m(31282),_e=m(62338),Gt=m(65848),Qt=m(97857),B=m.n(Qt),Vt=m(15009),x=m.n(Vt),Jt=m(64599),O=m.n(Jt),Kt=m(99289),k=m.n(Kt),Xt=m(19632),E=m.n(Xt),et=m(327),pe=m(32983),G=m(42075),C=m(28036),W,qt,Ie,q=1,_t=function(){var s=_e.Z.useApp();return W=s.message,Ie=s.modal,qt=s.notification,null};function er(s){q=parseInt(s)}var te=m(3909),tt=m(66227),me=m(86250),ae=m(83159),tr=m(98668),rr=m(63237),ar=m(99569),ir=m(36810),sr=m(19893),nr=m(42922),u=m(85893),lr=function(s){H()(n,s);var e=P()(n);function n(){var i;I()(this,n);for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return i=e.call.apply(e,[this].concat(r)),b()(w()(i),"state",{status:i.props.defaultStatus||!1}),i}return A()(n,[{key:"render",value:function(){var t=this;return(0,u.jsx)(C.ZP,{size:"small",type:"text",onClick:function(){t.props.onChange&&t.props.onChange(!t.state.status),t.setState({status:!t.state.status})},children:this.state.status?this.props.onNode||"ON":this.props.offNode||"OFF"})}}]),n}(z.Component),rt=lr;function or(s){return s.map(function(e){return e===-2?"window":"E-".concat(e)})}var ur=[{key:"D1-group-layer",label:"layer"},{key:"D1-group-group",label:"group"}],cr=function(s){H()(n,s);var e=P()(n);function n(){var i;I()(this,n);for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return i=e.call.apply(e,[this].concat(r)),b()(w()(i),"state",{treeData:[],rightClickMenuOpen:!1,groupKey:"layer"}),b()(w()(i),"treeData",[]),i}return A()(n,[{key:"selectKey2id",value:function(t){var r=this,a=[],l=O()(t),o;try{var c=function(){var v=o.value;if(v==="window")a.push(-2);else if(v.startsWith("E-"))a.push(parseInt(v.slice(2)));else{var p=r.treeData.find(function(M){return M.key===v}).children.map(function(M){return parseInt(M.key.slice(2))}),d=O()(p),g;try{for(d.s();!(g=d.n()).done;){var y=g.value;a.includes(y)||a.push(y)}}catch(M){d.e(M)}finally{d.f()}}};for(l.s();!(o=l.n()).done;)c()}catch(h){l.e(h)}finally{l.f()}return a}},{key:"onElementMenuContainerClick",value:function(t){t.target.classList.value.includes("ant-dropdown-menu")||(console.log(t.target.className),this.setState({rightClickMenuOpen:!1}),(t.target.classList.contains("ant-tree")||!t.ctrlKey&&!t.shiftKey)&&this.props.onSelect([]))}},{key:"onElementMenuClick",value:function(t){var r=this;if(this.setState({rightClickMenuOpen:!1}),t.key==="D2-copy"){var a=null;t.target.localName!=="input"&&this.props.selectedId.length!==0&&this.props.selectedId[0]!==-2&&(t.preventDefault(),a=JSON.stringify(this.props.selectedId.map(function(h){return r.props.data[h]})),t.clipboardData.setData("text",a))}else if(t.key==="D2-delete"){var l=O()(this.props.selectedId),o;try{for(l.s();!(o=l.n()).done;){var c=o.value;console.log(c),console.log(this.props.onObjectEvent("remove",{id:c}))}}catch(h){l.e(h)}finally{l.f()}}}},{key:"onElementRightClick",value:function(t){var r=this.selectKey2id([t.node.key]);r[0]in this.props.selectedId||this.props.onSelect(r)}},{key:"onSelect",value:function(t){if(t.length!==0){var r=this.selectKey2id(t);r.includes(-2)&&(r=[r[r.length-1]]),this.props.onSelect(r)}}},{key:"onMenuOpenChange",value:function(t){if(t){var r=this;setTimeout(function(){r.props.selectedId.length!==0&&r.props.selectedId[0]!==-2?r.setState({rightClickMenuOpen:!0}):r.setState({rightClickMenuOpen:!1})},100)}else this.setState({rightClickMenuOpen:!1})}},{key:"elementsMenuOnClick",value:function(t){var r=this;this.setState({groupKey:t.key.slice(9)},function(){return r.updateTree()})}},{key:"updateTree",value:function(){for(var t=this,r=this.state.groupKey,a=[],l=Object.keys(this.props.data),o=function(){for(var v=t.props.data[l[c]],p=-1,d=0;d<a.length;d++)if(a[d].key==="".concat(r,"-").concat(v[r])){p=d;break}p===-1&&(a.push({title:"".concat(r," ").concat(v[r]),key:"".concat(r,"-").concat(v[r]),children:[],isLeaf:!1}),p=a.length-1),a[p].children.push({title:(0,u.jsxs)(me.Z,{justify:"space-between",style:{width:"100%"},children:[v.name,(0,u.jsxs)(G.Z,{children:[(0,u.jsx)(rt,{onChange:function(y){return t.props.onObjectEvent("setAttr",{id:v.id,payload:{visible:y}})},defaultStatus:!0,offNode:(0,u.jsx)(rr.Z,{}),onNode:(0,u.jsx)(ar.Z,{})}),(0,u.jsx)(rt,{onChange:function(y){return t.props.onObjectEvent("setAttr",{id:v.id,payload:{selectable:y}})},defaultStatus:!0,offNode:(0,u.jsx)(ir.Z,{}),onNode:(0,u.jsx)(sr.Z,{style:{transform:"scaleX(-1)"}})})]})]}),key:"E-".concat(l[c])})},c=0;c<l.length;c++)o();return a=a.sort(function(h,v){return h.key.toString().localeCompare(v.key.toString())}),a.unshift({title:"UI Window",key:"window"}),this.treeData=a,a}},{key:"render",value:function(){var t=this;return(0,u.jsx)(et.Z,{size:"small",title:"Elements",style:{height:"100%"},extra:(0,u.jsx)(ae.Z,{menu:{items:ur,onClick:function(a){return t.elementsMenuOnClick(a)},selectable:!0,selectedKeys:["D1-group-".concat(this.state.groupKey)]},children:(0,u.jsxs)(G.Z,{style:{fontSize:11},children:["Group by",(0,u.jsx)(nr.Z,{size:"small"})]})}),children:(0,u.jsx)("div",{className:"card-body",onMouseUp:function(a){return t.onElementMenuContainerClick(a)},children:(0,u.jsx)(ae.Z,{menu:{items:[{key:"D2-copy",label:"Copy"},{key:"D2-delete",label:"Delete",danger:!0}],onClick:function(a){t.onElementMenuClick(a)}},trigger:["contextMenu"],open:this.state.rightClickMenuOpen,onOpenChange:function(a){t.onMenuOpenChange(a)},children:(0,u.jsx)(tr.Z,{className:"full",treeData:this.updateTree(),onSelect:function(a){return t.onSelect(a)},selectedKeys:or(this.props.selectedId),onRightClick:function(a){return t.onElementRightClick(a)},treeDefaultExpandAll:!0,showLine:!0,blockNode:!0,multiple:!0,selectable:this.props.editable})})})})}}]),n}(z.Component),hr=cr,U=m(32777),X=m(17990),dr=m(55733),fr=m.n(dr),ne=document.createElement("a"),ie=document.createElement("input");ie.type="file";var N={yellow:"rgb(255, 238, 70)",green:"rgb(168, 255, 45)",orange:"rgb(255, 163, 8)",purple:"rgb(240, 41, 246)",pink:"rgb(255, 100, 142)",cyan:"rgb(69, 255, 242)",white:"#fff",black:"#000",blue:"rgb(47, 168, 223)",red:"rgb(255, 69, 70)"};function at(s){var e=s.split(".").pop();return{name:e+" file",extensions:[e]}}function Ae(s,e){if(V())k()(x()().mark(function t(){var r;return x()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,X.WZ.save({filters:[at(e)],defaultPath:e});case 2:if(r=l.sent,!(r!==null&&r.length>0)){l.next=6;break}return l.next=6,X.fs.writeTextFile(r,s);case 6:case"end":return l.stop()}},t)}))();else{var n=new Blob([s],{type:"text/plain;charset=utf-8"}),i=URL.createObjectURL(n);ne.href=i,ne.download=e,ne.click(),URL.revokeObjectURL(i)}}function it(s,e){if(V())k()(x()().mark(function i(){var t,r;return x()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,X.WZ.save({filters:[at(e)],defaultPath:e});case 2:if(t=l.sent,!(t!==null&&t.length>0)){l.next=9;break}return l.next=6,s.arrayBuffer();case 6:return r=l.sent,l.next=9,X.fs.writeBinaryFile(t,r);case 9:case"end":return l.stop()}},i)}))();else{var n=URL.createObjectURL(s);ne.href=n,ne.download=e,ne.click(),URL.revokeObjectURL(n)}}function Te(s,e,n){var i={version:2,data:s,selected:n},t=JSON.stringify(i);Ae(t,e)}function vr(s){var e=null;return window.createObjcectURL!==void 0?e=window.createOjcectURL(s):window.URL!==void 0?e=window.URL.createObjectURL(s):window.webkitURL!==void 0&&(e=window.webkitURL.createObjectURL(s)),e}function V(){return window!==void 0&&window.__TAURI__!==void 0}function pr(s){return De.apply(this,arguments)}function De(){return De=k()(x()().mark(function s(e){var n;return x()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=new(fr()),e.forEach(function(r){n.file(r.fileName,r.content)}),t.next=4,n.generateAsync({type:"blob"});case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}},s)})),De.apply(this,arguments)}function st(s){return Oe.apply(this,arguments)}function Oe(){return Oe=k()(x()().mark(function s(e){var n,i,t;return x()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:n=[];for(i in e)for(t in e[i])n.push({fileName:"".concat(i,".").concat(t),content:e[i][t]});return a.next=4,pr(n);case 4:return a.abrupt("return",a.sent);case 5:case"end":return a.stop()}},s)})),Oe.apply(this,arguments)}function Ee(s){return new Promise(function(e,n){if(V()){var i=[s.slice(1)],t="".concat(i," file");s==="image/*"&&(i=["png","jpg","jpeg","gif","webp","bmp","ico","svg"],t="image"),k()(x()().mark(function r(){var a,l,o,c,h;return x()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,X.WZ.open({multiple:!1,directory:!1,filters:[{name:t,extensions:i}]});case 2:if(a=p.sent,!(a!==null&&a.length>0)){p.next=16;break}return l=a.replace(/\\/g,"/"),o=l.split("/").pop(),p.t0=Blob,p.next=9,X.fs.readBinaryFile(a);case 9:p.t1=p.sent,p.t2=[p.t1],c=new p.t0(p.t2),h=new File([c],o),e(h),p.next=17;break;case 16:n();case 17:case"end":return p.stop()}},r)}))()}else ie.accept=s,ie.value="",ie.onchange=function(){if(ie.files.length>0){var r=ie.files[0];e(r)}else n(new Error("No file selected"))},ie.click()})}function ge(s){return document.getElementById("content-in").contains(s)||s.getAttribute("contentEditable")==="true"?!0:s.tagName==="INPUT"||s.tagName==="TEXTAREA"}var mr=function(s){H()(n,s);var e=P()(n);function n(){return I()(this,n),e.apply(this,arguments)}return A()(n,[{key:"render",value:function(){return this.props.color==="Main"?(0,u.jsxs)("div",{children:[(0,u.jsxs)("div",{style:{border:"1px solid #aaa",height:16,width:16,borderRadius:"20%",display:"inline-flex"},children:[(0,u.jsx)("div",{style:{backgroundColor:"red",height:12,width:6,margin:"1px 0 1px 1px",borderTopLeftRadius:"20%",borderBottomLeftRadius:"20%",display:"inline-flex"}}),(0,u.jsx)("div",{style:{backgroundColor:"blue",height:12,width:6,margin:"1px 1px 1px 0",borderTopRightRadius:"20%",borderBottomRightRadius:"20%",display:"inline-flex"}})]}),"\xA0 Main"]}):(0,u.jsx)("div",{children:(0,u.jsxs)("div",{children:[(0,u.jsx)("div",{style:{border:"1px solid #aaa",height:16,width:16,borderRadius:"20%",display:"inline-flex"},children:(0,u.jsx)("div",{style:{backgroundColor:N[this.props.color.toLowerCase()],height:12,width:12,margin:1,borderRadius:"20%",display:"inline-flex"}})}),"\xA0 ",this.props.color]})})}}]),n}(z.Component),J=mr,nt=function(e){var n=e,i="Robot";e>256&&(i="Client",e-=256);var t;e>100?t="Blue":t="Red",e%=100;var r={1:"Hero",2:"Engineer",3:"No3. Infantry",4:"No4. Infantry",5:"No5. Infantry",6:"Drone"};return"".concat(t," ").concat(r[e]," ").concat(i," (").concat(n,")")},lt={id:{title:"Id",key:"id",dataIndex:"id",valueType:"digit",editable:!1},name:{title:"Name",key:"name",dataIndex:"name"},group:{title:"Group",key:"group",dataIndex:"group"},kind:{title:"Kind",key:"kind",dataIndex:"kind",editable:!1},lineWidth:{title:"Line Width",key:"lineWidth",dataIndex:"lineWidth",valueType:"digit"},layer:{title:"Layer",key:"layer",dataIndex:"layer",valueType:"digit"},x:{title:"X",key:"x",dataIndex:"x",valueType:"digit"},y:{title:"Y",key:"y",dataIndex:"y",valueType:"digit"},x2:{title:"X2",key:"x2",dataIndex:"x2",valueType:"digit"},y2:{title:"Y2",key:"y2",dataIndex:"y2",valueType:"digit"},width:{title:"Width",key:"width",dataIndex:"width",valueType:"digit"},height:{title:"Height",key:"height",dataIndex:"height",valueType:"digit"},rx:{title:"Rx",key:"rx",dataIndex:"rx",valueType:"digit"},ry:{title:"Ry",key:"ry",dataIndex:"ry",valueType:"digit"},r:{title:"R",key:"r",dataIndex:"r",valueType:"digit"},startAngle:{title:"Start Angle",key:"startAngle",dataIndex:"startAngle",valueType:"digit"},endAngle:{title:"End Angle",key:"endAngle",dataIndex:"endAngle",valueType:"digit"},fontSize:{title:"Font Size",key:"fontSize",dataIndex:"fontSize",valueType:"digit"},float:{title:"Number",key:"float",dataIndex:"float",valueType:"digit"},number:{title:"Number",key:"number",dataIndex:"number",valueType:"digit"},text:{title:"Text",key:"text",dataIndex:"text",formItemProps:{rules:[{max:30},{type:"string"}]}},color:{title:"Color",key:"color",dataIndex:"color",valueType:"select",valueEnum:{main:(0,u.jsx)(J,{color:"Main"}),yellow:(0,u.jsx)(J,{color:"Yellow"}),green:(0,u.jsx)(J,{color:"Green"}),orange:(0,u.jsx)(J,{color:"Orange"}),purple:(0,u.jsx)(J,{color:"Purple"}),pink:(0,u.jsx)(J,{color:"Pink"}),cyan:(0,u.jsx)(J,{color:"Cyan"}),black:(0,u.jsx)(J,{color:"Black"}),white:(0,u.jsx)(J,{color:"White"})}},team:{title:"Team",key:"team",dataIndex:"team",valueType:"select",valueEnum:{red:(0,u.jsx)(J,{color:"Red"}),blue:(0,u.jsx)(J,{color:"Blue"})}},role:{title:"Role",key:"role",dataIndex:"role",valueType:"select",valueEnum:{1:"Hero",2:"Engineer",3:"No3. Infantry",4:"No4. Infantry",5:"No5. Infantry",6:"Drone"}},backgroundImage:{title:"Background Image",key:"backgroundImage",dataIndex:"backgroundImage",valueType:"switch"},length:{title:"DataLength",key:"length",dataIndex:"length",valueType:"digit"},seq:{title:"Seq",key:"seq",dataIndex:"seq",valueType:"digit"},cmd_id:{title:"Cmd Id",key:"cmd_id",dataIndex:"cmd_id",valueType:"text",renderText:function(e){return"0x".concat(e.toString(16).padStart(4,"0"))}},sub_id:{title:"Sub Id",key:"sub_id",dataIndex:"sub_id",valueType:"text",renderText:function(e){return"0x".concat(e.toString(16).padStart(4,"0"))}},sender:{title:"Sender",key:"sender",dataIndex:"sender",valueType:"select",renderText:nt},receiver:{title:"Receiver",key:"receiver",dataIndex:"receiver",valueType:"select",renderText:nt},error:{title:"Error",key:"error",dataIndex:"error",valueType:"text"},operation:{title:"Operation",key:"operation",dataIndex:"operation",valueType:"text"}};function ot(s){for(var e=Object.keys(s),n=[],i=0;i<e.length;i++)lt[e[i]]&&n.push(lt[e[i]]);return n}var gr=U.fabric.util.createClass(U.fabric.Rect,{type:"UiRect",id:0,name:"",layer:0,groupName:"",ratio:1,_color:"",team:"red",initialize:function(e){e||(e={}),e.color||(e.color="main"),this.id=e.id,this.name=e.name,this.layer=e.layer,this.groupName=e.groupName,this.ratio=e.ratio,this._color=e.color,this.team=e.team,e.lockRotation=!0,e.lockScalingFlip=!0,e.hasRotatingPoint=!1,e.width||(e.width=50/this.ratio),e.height||(e.height=50/this.ratio),e.left||(e.left=50/this.ratio),e.top||(e.top=50/this.ratio),e.strokeWidth||(e.strokeWidth=1/this.ratio),this._color&&this._color!=="main"?e.stroke=N[this._color]:(e.stroke=N[e.team],this._color="main"),e.fill=null,this.callSuper("initialize",e),this.moveTo(e.layer),this.setControlVisible("mtr",!1),this.transparentCorners=!1},resizeScale:function(){this.set("width",Math.round(this.width*this.scaleX*this.ratio)/this.ratio),this.set("height",Math.round(this.height*this.scaleY*this.ratio)/this.ratio),this.set("left",Math.round(this.left*this.ratio)/this.ratio),this.set("top",Math.round(this.top*this.ratio)/this.ratio),this.set("scaleX",1),this.set("scaleY",1)},toObject:function(){return{type:this.type,id:this.id,name:this.name,layer:this.layer,group:this.groupName,width:this.width*this.ratio,height:this.height*this.ratio,x:this.left*this.ratio,y:this.top*this.ratio,color:this._color,lineWidth:this.strokeWidth*this.ratio}},fromObject:function(e){this._color=e.color,this.id=e.id,this.name=e.name,this.layer=e.layer,this.groupName=e.group,this.set("width",e.width/this.ratio),this.set("height",e.height/this.ratio),this.set("left",e.x/this.ratio),this.set("top",e.y/this.ratio),this.set("strokeWidth",e.lineWidth/this.ratio),this._color==="main"?this.set("stroke",N[this.team]):this.set("stroke",N[this._color]),this.moveTo(e.layer)},setRatio:function(e){this.set("width",this.width*this.ratio/e),this.set("height",this.height*this.ratio/e),this.set("left",this.left*this.ratio/e),this.set("top",this.top*this.ratio/e),this.set("strokeWidth",this.strokeWidth*this.ratio/e),this.ratio=e},setTeam:function(e){this.team=e,this._color==="main"&&this.set("stroke",N[this.team])}}),yr=U.fabric.util.createClass(U.fabric.Line,{type:"UiLine",id:0,name:"",layer:0,groupName:"",ratio:1,_color:"",team:"red",initialize:function(e){e||(e={}),e.color||(e.color="main"),this.id=e.id,this.name=e.name,this.layer=e.layer,this.groupName=e.groupName,this.ratio=e.ratio,this._color=e.color,this.team=e.team,e.lockRotation=!0,e.lockScalingFlip=!0,e.hasRotatingPoint=!1,e.x1||(e.x1=50/this.ratio),e.y1||(e.y1=50/this.ratio),e.x2||(e.x2=100/this.ratio),e.y2||(e.y2=100/this.ratio),e.strokeWidth||(e.strokeWidth=1/this.ratio),this._color&&this._color!=="main"?e.stroke=N[this._color]:(e.stroke=N[e.team],this._color="main"),e.fill=null,this.callSuper("initialize",[e.x1,e.y1,e.x2,e.y2],e),this.moveTo(e.layer),this.setControlVisible("mtr",!1),this.transparentCorners=!1},resizeScale:function(){var e=Math.min(this.x1,this.x2),n=Math.min(this.y1,this.y2),i=this.left-e,t=this.top-n;if(this.x1<this.x2){var r=Math.round((this.x2-this.x1)*this.scaleX);this.set("x1",Math.round((this.x1+i)*this.ratio)/this.ratio),this.set("x2",Math.round((this.x1+r)*this.ratio)/this.ratio)}else{var a=Math.round((this.x1-this.x2)*this.scaleX);this.set("x2",Math.round((this.x2+i)*this.ratio)/this.ratio),this.set("x1",Math.round((this.x2+a)*this.ratio)/this.ratio)}if(this.y1<this.y2){var l=Math.round((this.y2-this.y1)*this.scaleY);this.set("y1",Math.round((this.y1+t)*this.ratio)/this.ratio),this.set("y2",Math.round((this.y1+l)*this.ratio)/this.ratio)}else{var o=Math.round((this.y1-this.y2)*this.scaleY);this.set("y2",Math.round((this.y2+t)*this.ratio)/this.ratio),this.set("y1",Math.round((this.y2+o)*this.ratio)/this.ratio)}this.set("scaleX",1),this.set("scaleY",1)},toObject:function(){return{type:this.type,id:this.id,name:this.name,layer:this.layer,group:this.groupName,x:this.x1*this.ratio,y:this.y1*this.ratio,x2:this.x2*this.ratio,y2:this.y2*this.ratio,color:this._color,lineWidth:this.strokeWidth*this.ratio}},fromObject:function(e){this._color=e.color,this.id=e.id,this.name=e.name,this.layer=e.layer,this.groupName=e.group,this.set("x2",e.x2/this.ratio),this.set("y2",e.y2/this.ratio),this.set("x1",e.x/this.ratio),this.set("y1",e.y/this.ratio),this.set("strokeWidth",e.lineWidth/this.ratio),this._color==="main"?this.set("stroke",N[this.team]):this.set("stroke",N[this._color]),this.moveTo(e.layer)},setRatio:function(e){this.set("x1",this.x1*this.ratio/e),this.set("y1",this.y1*this.ratio/e),this.set("x2",this.x2*this.ratio/e),this.set("y2",this.y2*this.ratio/e),this.set("strokeWidth",this.strokeWidth*this.ratio/e),this.ratio=e},setTeam:function(e){this.team=e,this._color==="main"&&this.set("stroke",N[this.team])}}),Ne=U.fabric.util.createClass(U.fabric.Ellipse,{type:"UiEllipse",id:0,name:"",layer:0,groupName:"",ratio:1,_color:"",team:"red",initialize:function(e){e||(e={}),e.color||(e.color="main"),this.id=e.id,this.name=e.name,this.layer=e.layer,this.groupName=e.groupName,this.ratio=e.ratio,this._color=e.color,this.team=e.team,e.lockRotation=!0,e.lockScalingFlip=!0,e.hasRotatingPoint=!1,e.rx||(e.rx=50/this.ratio),e.ry||(e.ry=50/this.ratio),e.left||(e.left=50/this.ratio),e.top||(e.top=50/this.ratio),e.strokeWidth||(e.strokeWidth=1/this.ratio),this._color&&this._color!=="main"?e.stroke=N[this._color]:(e.stroke=N[e.team],this._color="main"),e.fill=null,this.callSuper("initialize",e),this.moveTo(e.layer),this.setControlVisible("mtr",!1),this.transparentCorners=!1},resizeScale:function(){this.set("rx",Math.round(this.rx*this.scaleX*this.ratio)/this.ratio),this.set("ry",Math.round(this.ry*this.scaleY*this.ratio)/this.ratio),this.set("left",Math.round(this.left*this.ratio)/this.ratio),this.set("top",Math.round(this.top*this.ratio)/this.ratio),this.set("scaleX",1),this.set("scaleY",1)},toObject:function(){return{type:this.type,id:this.id,name:this.name,layer:this.layer,group:this.groupName,rx:this.rx*this.ratio,ry:this.ry*this.ratio,x:(this.left+this.rx)*this.ratio,y:(this.top+this.ry)*this.ratio,color:this._color,lineWidth:this.strokeWidth*this.ratio}},fromObject:function(e){this._color=e.color,this.id=e.id,this.name=e.name,this.layer=e.layer,this.groupName=e.group,this.set("rx",e.rx/this.ratio),this.set("ry",e.ry/this.ratio),this.set("left",(e.x-e.rx)/this.ratio),this.set("top",(e.y-e.ry)/this.ratio),this.set("strokeWidth",e.lineWidth/this.ratio),this._color==="main"?this.set("stroke",N[this.team]):this.set("stroke",N[this._color]),this.moveTo(e.layer)},setRatio:function(e){this.set("rx",this.rx*this.ratio/e),this.set("ry",this.ry*this.ratio/e),this.set("left",this.left*this.ratio/e),this.set("top",this.top*this.ratio/e),this.set("strokeWidth",this.strokeWidth*this.ratio/e),this.ratio=e},setTeam:function(e){this.team=e,this._color==="main"&&this.set("stroke",N[this.team])}}),xr=U.fabric.util.createClass(Ne,{type:"UiRound",r:50,initialize:function(e){e||(e={}),e.r||(e.r=50/this.ratio),e.rx=e.r,e.ry=e.r,this.callSuper("initialize",e),this.setControlVisible("ml",!1),this.setControlVisible("mb",!1),this.setControlVisible("mr",!1),this.setControlVisible("mt",!1)},toObject:function(){return{type:this.type,id:this.id,name:this.name,layer:this.layer,group:this.groupName,r:this.rx*this.ratio,x:(this.left+this.rx)*this.ratio,y:(this.top+this.ry)*this.ratio,color:this._color,lineWidth:this.strokeWidth*this.ratio}},fromObject:function(e){e.rx=e.r,e.ry=e.r,this.callSuper("fromObject",e)}}),br=U.fabric.util.createClass(Ne,{type:"UiArc",startAngle:0,endAngle:90,initialize:function(e){e||(e={}),e.startAngle||(e.startAngle=0),e.endAngle||(e.endAngle=90),this.callSuper("initialize",e),this.startAngle=e.startAngle,this.endAngle=e.endAngle,this.set("dirty",!0)},toObject:function(){return U.fabric.util.object.extend(this.callSuper("toObject"),{startAngle:this.startAngle,endAngle:this.endAngle})},_render:function(e){var n=(this.startAngle-90)*(Math.PI/180),i=(this.endAngle-90)*(Math.PI/180);e.beginPath(),e.ellipse(0,0,this.rx,this.ry,0,n,i,!1),e.strokeStyle=this.stroke,e.lineWidth=this.strokeWidth,e.stroke()},fromObject:function(e){this.set("startAngle",e.startAngle),this.set("endAngle",e.endAngle),this.set("ry",1),this.callSuper("fromObject",e)}}),ye=1.25;function se(s,e){var n=se.canvas||(se.canvas=document.createElement("canvas")),i=n.getContext("2d");i.font=e;var t=i.measureText(s);return t.width*ye}var Fe=U.fabric.util.createClass(U.fabric.Text,{type:"UiText",id:0,name:"",layer:0,groupName:"",ratio:1,_color:"",team:"red",rawFontSize:0,initialize:function(e){var n=this;e||(e={}),e.color||(e.color="main"),this.id=e.id,this.name=e.name,this.layer=e.layer,this.groupName=e.groupName,this.ratio=e.ratio,this._color=e.color,this.team=e.team,e.flipY=!0,e.fontSize||(e.fontSize=20/this.ratio),e.fontSize*=ye,e.fontFamily||(e.fontFamily="ds-digitalnormal"),e.text||(e.text="Text"),e.left||(e.left=50/this.ratio),e.top||(e.top=50/this.ratio),e.top-=e.fontSize/this.ratio*2,e.width||(e.width=se(e.text,e.fontSize+"px "+e.fontFamily)*this.ratio),this.rawFontSize=e.fontSize,this._color&&this._color!=="main"?e.fill=N[this._color]:(e.fill=N[e.team],this._color="main"),this.callSuper("initialize",e.text,e),this.moveTo(e.layer),this.setControlsVisibility({tl:!1,tr:!1,bl:!1,br:!1,ml:!1,mt:!1,mr:!1,mb:!1,mtr:!1}),setTimeout(function(){n.set("width",se(e.text,e.fontSize+"px "+e.fontFamily)/n.ratio)},100)},toObject:function(){return{type:this.type,id:this.id,name:this.name,layer:this.layer,group:this.groupName,fontSize:this.fontSize*this.ratio/ye,x:this.left*this.ratio,y:this.top*this.ratio+this.fontSize*2,text:this.text,color:this._color}},fromObject:function(e){var n=this;this._color=e.color,this.id=e.id,this.name=e.name,this.layer=e.layer,this.groupName=e.group,this.set("fontSize",e.fontSize/this.ratio*ye),this.set("left",e.x/this.ratio),this.set("top",e.y/this.ratio-this.fontSize/this.ratio*2),this.text=e.text,this.set("width",se(e.text,e.fontSize+"px "+this.fontFamily)/this.ratio),this.rawFontSize=e.fontSize,setTimeout(function(){n.set("width",se(e.text,e.fontSize+"px "+n.fontFamily)/n.ratio)},100),this._color==="main"?this.set("fill",N[this.team]):this.set("fill",N[this._color]),this.moveTo(e.layer),this.set("fontFamily","ds-digitalnormal")},setRatio:function(e){this.set("width",this.width*this.ratio/e),this.set("left",this.left*this.ratio/e),this.set("top",this.top*this.ratio/e),this.set("fontSize",this.fontSize*this.ratio/e),this.set("width",se(this.text,this.rawFontSize+"px "+this.fontFamily)/e),this.ratio=e},resizeScale:function(){},setTeam:function(e){this.team=e,this._color==="main"&&this.set("fill",N[this.team])}}),Mr=U.fabric.util.createClass(Fe,{type:"UiNumber",number:12345,initialize:function(e){e||(e={}),this.number=e.number||12345,e.text=this.number.toString(),this.callSuper("initialize",e)},toObject:function(){var e=this.callSuper("toObject");return e.number=this.number,delete e.text,e},fromObject:function(e){this.number=parseInt(e.number),e.text=this.number.toString(),this.callSuper("fromObject",e)}}),wr=U.fabric.util.createClass(Fe,{type:"UiFloat",float:12.345,initialize:function(e){e||(e={}),this.float=e.float||12.345,e.text=this.float.toString(),this.callSuper("initialize",e)},toObject:function(){var e=this.callSuper("toObject");return e.float=this.float,delete e.text,e},fromObject:function(e){this.float=parseFloat(e.float),e.text=this.float.toString(),this.callSuper("fromObject",e)}}),ut={Rect:gr,Line:yr,Round:xr,Ellipse:Ne,Arc:br,Text:Fe,Number:Mr,Float:wr};function kr(s){var e={id:s.id,name:s.name,layer:s.layer,groupName:s.group,ratio:s.ratio,team:s.team},n=s.type.slice(2);return new ut[n](e)}function Sr(){for(var s=[],e=0,n=Object.keys(ut);e<n.length;e++){var i=n[e];s.push({key:"Insert-".concat(i),label:i})}return s}function xe(s,e,n,i){return Re.apply(this,arguments)}function Re(){return Re=k()(x()().mark(function s(e,n,i,t){var r,a,l,o,c,h,v,p,d,g;return x()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:if(e){M.next=2;break}return M.abrupt("return");case 2:if(r=1,e.version&&(r=e.version),r!==1){M.next=10;break}return M.next=7,i("default");case 7:for(a=0,l=Object.keys(e);a<l.length;a++)o=l[a],n("_update",e[o]);M.next=22;break;case 10:if(r!==2){M.next=22;break}c=0,h=Object.keys(e.data);case 12:if(!(c<h.length)){M.next=20;break}return v=h[c],M.next=16,i(v);case 16:for(p=0,d=Object.keys(e.data[v]);p<d.length;p++)g=d[p],n("_update",e.data[v][g]);case 17:c++,M.next=12;break;case 20:return M.next=22,i(e.selected);case 22:t();case 23:case"end":return M.stop()}},s)})),Re.apply(this,arguments)}var jr=m(96486),ct=m.n(jr);function ht(s){return s.head>0?B()({},s.data[s.head-1]):null}function dt(s){return s.head<s.data.length-1?B()({},s.data[s.head+1]):null}var zr=function(){function s(){I()(this,s),b()(this,"cacheTimer",null),b()(this,"updateTimer",null),b()(this,"now",null),b()(this,"_previous",null),b()(this,"_next",null),b()(this,"his",null),b()(this,"catchUpdate",!0);var e=localStorage.getItem("history"),n={data:[{}],head:0,version:1};e?n=JSON.parse(e):(e=localStorage.getItem("data"),e?n.data[0]=JSON.parse(e):n.data[0]={version:2,data:{default:{}},selected:"default"},localStorage.setItem("history",JSON.stringify(n))),this.now=n.data[n.head],this._previous=ht(n),this._next=dt(n)}return A()(s,[{key:"save",value:function(){var n=this;this.cacheTimer&&clearTimeout(this.cacheTimer),this.cacheTimer=setTimeout(function(){n.his.head>50&&(n.his.data=n.his.data.slice(n.his.head-50),n.his.head=50),n.his.head<n.his.data.length-20&&(n.his.data=n.his.data.slice(0,n.his.head+20)),localStorage.setItem("history",JSON.stringify(n.his)),n.his=null},2e3)}},{key:"read",value:function(){this.his||(this.his=JSON.parse(localStorage.getItem("history")))}},{key:"get",value:function(){return this.catchUpdate?{now:this.now,couldNext:this._next!==null,couldPrevious:this._previous!==null}:{now:this.now,couldNext:!1,couldPrevious:!1}}},{key:"reset",value:function(n){return this._previous=null,this._next=null,this.his={data:[n],head:0,version:1},this.save(),this.get()}},{key:"next",value:function(){return this._next&&(this._previous=this.now,this.now=this._next,this.read(),this.his.head++,this._next=dt(this.his),this.save()),this.get()}},{key:"previous",value:function(){return this._previous&&(this._next=this.now,this.now=this._previous,this.read(),this.his.head--,this._previous=ht(this.his),this.save()),this.get()}},{key:"cancelUpdate",value:function(){this.updateTimer&&clearTimeout(this.updateTimer)}},{key:"update",value:function(n){var i=this;this.catchUpdate&&(this.updateTimer&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(function(){ct().isEqual(n,i.now)||(i._previous=i.now,i.now=n,i.read(),i.his.data=i.his.data.slice(0,i.his.head+1),i.his.data.push(n),i.his.head++,i._next=null,i.save())},500))}}]),s}(),Cr=zr,Ir=m(30819),Ar=function(s){H()(n,s);var e=P()(n);function n(){var i;I()(this,n);for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return i=e.call.apply(e,[this].concat(r)),b()(w()(i),"objects",{default:{}}),b()(w()(i),"data",{}),b()(w()(i),"state",{properties:null,selectedId:[],frame:"default",uiWindow:{height:1080,width:1920,ratio:1,team:"red",role:1,backgroundImage:!0},infoModalShow:!1,data:{},editable:!0}),b()(w()(i),"canvas",null),b()(w()(i),"canvasRef",(0,z.createRef)()),b()(w()(i),"propertiesRef",(0,z.createRef)()),b()(w()(i),"background",null),b()(w()(i),"his",new Cr),b()(w()(i),"moveTimer",null),b()(w()(i),"moveTimeout",null),i}return A()(n,[{key:"getNewDataId",value:function(){return Object.keys(this.state.data).length===0?0:Math.max.apply(Math,E()(Object.keys(this.state.data)))+1}},{key:"setEditable",value:function(){var i=k()(x()().mark(function r(a){var l,o,c,h,v;return x()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(this.setState({editable:a}),this.his.catchUpdate=a,this.canvas.selection=a,U.fabric.Object.prototype.selectable=a,!a){d.next=9;break}return d.next=7,this.onHistoryEvent("refresh");case 7:d.next=15;break;case 9:return l=this.state.uiWindow.role,d.next=12,this.reset(!0);case 12:this.cancelHistoryUpdate(),this.props.setCouldDo({couldNext:!1,couldPrevious:!1}),this.setRobotId(l);case 15:o=this.canvas.getObjects(),c=O()(o);try{for(c.s();!(h=c.n()).done;)v=h.value,v.set("selectable",a)}catch(g){c.e(g)}finally{c.f()}this.select([]);case 19:case"end":return d.stop()}},r,this)}));function t(r){return i.apply(this,arguments)}return t}()},{key:"setRobotId",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;t===0&&(t=this.state.uiWindow.role),typeof t=="string"&&(t=parseInt(t)),this.state.uiWindow.team==="blue"&&(t+=100),er(t)}},{key:"cancelHistoryUpdate",value:function(){var t=this;this.his.cancelUpdate(),setTimeout(function(){t.his.cancelUpdate(),t.props.setCouldDo(t.his.get())},200)}},{key:"save",value:function(){Te(this.data,"ui.rmui",this.state.frame)}},{key:"updateHistory",value:function(){var t=this;setTimeout(function(){var r={version:2,data:t.data,selected:t.state.frame};ct().isEqual(r,t.his.now)||(t.his.update(r),t.props.setCouldDo({couldNext:!1,couldPrevious:!0}))},100)}},{key:"getData",value:function(){return this.data}},{key:"select",value:function(t,r){var a=this;if(t.length===0)this.setState({properties:null,selectedId:[]}),this.canvas.discardActiveObject(),this.canvas.renderAll();else if(t[0]===-2)this.setState({properties:this.state.uiWindow,selectedId:[-2]}),this.canvas.discardActiveObject(),this.canvas.renderAll();else if(t.length===1)this.setState({properties:this.state.data[t[0]],selectedId:[t[0]]}),this.canvas.setActiveObject(this.objects[this.state.frame][t[0]]),this.canvas.renderAll();else if(this.setState({properties:null,selectedId:t}),!r){var l=t.map(function(c){return a.objects[a.state.frame][c]}),o=new U.fabric.ActiveSelection(l,{canvas:this.canvas});this.canvas.setActiveObject(o),this.canvas.renderAll()}}},{key:"reset",value:function(){var i=k()(x()().mark(function r(){var a,l,o,c=arguments;return x()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(a=c.length>0&&c[0]!==void 0?c[0]:!1,a){l=this.canvas.getObjects();for(o in l)this.canvas.remove(l[o]);this.canvas.renderAll()}else this.canvas.clear(),this.setBackground(m(25665)),this.canvas.backgroundColor="#fff";if(Object.keys(this.objects).includes("default")){v.next=5;break}return v.next=5,this.onFrameEvent("add","default");case 5:return this.objects.default={},v.next=8,this.onFrameEvent("change","default");case 8:this.objects={default:{}},this.props.onFrameChange({frames:["default"],selected:"default"}),this.select([]),this.resetCanvasSize(),this.objectsToData();case 13:case"end":return v.stop()}},r,this)}));function t(){return i.apply(this,arguments)}return t}()},{key:"resetCanvasSize",value:function(){if(this.canvas){var t,r=this.canvasRef.current.clientWidth,a=this.canvasRef.current.clientHeight,l=B()({},this.state.uiWindow);r/a<l.width/l.height?(a=r*l.height/l.width,l.ratio=l.width/r):(r=a*l.width/l.height,l.ratio=l.height/a),this.setState({uiWindow:l}),this.canvas.setHeight(a),this.canvas.setWidth(r),this.canvas.viewportTransform[5]=a,this.canvas.viewportTransform[3]=-1;var o=this.canvasRef.current.clientWidth,c=this.canvasRef.current.clientHeight,h=o-r,v=c-a,p=document.getElementById("coordinateDisplay");p.style.right="".concat(h+12,"px"),p.style.bottom="".concat(v+25,"px");for(var d=0,g=Object.keys(this.objects[this.state.frame]);d<g.length;d++){var y=g[d];this.objects[this.state.frame][y].setRatio(l.ratio)}(t=this.background)===null||t===void 0||t.set({scaleX:1/l.ratio,scaleY:1/l.ratio}),this.canvas.renderAll(),this.objectsToData(),this.setState({infoModalShow:!1})}}},{key:"onPropertiesChange",value:function(t,r){var a=this;if(this.state.selectedId[0]===-2){if(r.team!==this.state.uiWindow.team){for(var l=0,o=Object.keys(this.objects[this.state.frame]);l<o.length;l++){var c=o[l];this.objects[this.state.frame][c].setTeam(r.team)}this.canvas.renderAll(),this.objectsToData()}if(this.setState({uiWindow:r,properties:r},function(){a.resetCanvasSize(),a.setRobotId()}),r.backgroundImage!==this.state.uiWindow.backgroundImage)if(r.backgroundImage){var h,v=this.state.uiWindow.ratio;(h=this.background)===null||h===void 0||h.set({scaleX:1/v,scaleY:1/v}),this.canvas.setBackgroundImage(this.background),this.canvas.renderAll()}else this.canvas.setBackgroundImage(null),this.canvas.renderAll();(r.width!==this.state.uiWindow.width||r.height!==this.state.uiWindow.height)&&Ie.warning({title:"Warning",content:"Modify UI window width and height may cause unknown error."})}else this.state.selectedId.length===1&&(this.objects[this.state.frame][this.state.selectedId[0]].fromObject(r),this.canvas.renderAll(),this.objectsToData(),this.updateHistory())}},{key:"setBackground",value:function(t){var r=this;U.fabric.Image.fromURL(t,function(a,l){var o;r.background=a;var c=r.state.uiWindow.ratio;(o=r.background)===null||o===void 0||o.set({scaleX:1/c,scaleY:-1/c}),r.state.uiWindow.backgroundImage&&(r.canvas.setBackgroundImage(r.background),r.canvas.renderAll())})}},{key:"componentDidMount",value:function(){var t=this,r=this;this.canvas=new U.fabric.Canvas("ui"),this.setBackground(m(25665)),this.canvas.backgroundColor="#fff",window.addEventListener("resize",function(){t.resetCanvasSize()},!1),window.addEventListener("copy",function(a){var l=null;console.log(a.target,ge(a.target)),!ge(a.target)&&r.state.selectedId.length!==0&&r.state.selectedId[0]!==-2&&(a.preventDefault(),l=JSON.stringify(r.state.selectedId.map(function(o){return r.state.data[o]})),a.clipboardData.setData("text",l))}),window.addEventListener("paste",function(a){for(var l=!1,o=a.clipboardData.items,c=0;c<o.length;c++)if(o[c].type.indexOf("image")===0){a.preventDefault(),l=!0;var h=o[c].getAsFile(),v=new FileReader;v.onload=function(L){r.setBackground(L.target.result)},v.readAsDataURL(h)}if(!l&&!ge(a.target))try{a.preventDefault();var p=a.clipboardData.getData("text"),d=JSON.parse(p);Array.isArray(d)||(d=[d]);var g=[],y=20,M=O()(d),j;try{var S=function(){var F=j.value;setTimeout(function(){F.id=r.getNewDataId(),g.push(F.id),r.onObjectEvent("_update",F)},y),y+=20};for(M.s();!(j=M.n()).done;)S()}catch(L){M.e(L)}finally{M.f()}setTimeout(function(){r.select(g),t.updateHistory()},y)}catch(L){W.warning("Invalid data")}}),window.addEventListener("keydown",function(a){if(a.key==="Delete"&&r.state.selectedId.length!==0&&r.state.selectedId[0]!==-2){var l=O()(r.state.selectedId),o;try{for(l.s();!(o=l.n()).done;){var c=o.value;r.onObjectEvent("remove",{id:c})}}catch(p){l.e(p)}finally{l.f()}t.updateHistory()}if(a.ctrlKey&&a.key==="z"&&!a.shiftKey?(a.preventDefault(),t.onHistoryEvent("previous")):a.ctrlKey&&(0,Ir.toLower)(a.key)==="z"&&a.shiftKey&&(a.preventDefault(),t.onHistoryEvent("next")),["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(a.key)&&!ge(a.target)){var h=function(d,g){switch(g*=r.state.uiWindow.ratio,d){case"ArrowUp":v.top+=g;break;case"ArrowDown":v.top-=g;break;case"ArrowLeft":v.left-=g;break;case"ArrowRight":v.left+=g;break}v instanceof U.fabric.ActiveSelection?v.getObjects().forEach(function(y){y.setCoords(),y.resizeScale()}):(v.setCoords(),v.resizeScale()),r.canvas.renderAll(),r.objectsToData(),r.updateHistory()},v=r.canvas.getActiveObject();if(!v)return;a.preventDefault(),h(a.key,2),t.moveTimeout&&clearTimeout(t.moveTimeout),t.moveTimer&&clearInterval(t.moveTimer),t.moveTimeout=setTimeout(function(){t.moveTimer=setInterval(function(){h(a.key,1)},500)},1500)}}),window.addEventListener("keyup",function(a){["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(a.key)&&(clearTimeout(t.moveTimeout),clearInterval(t.moveTimer))}),this.canvas.on({"mouse:up":function(){for(var l=0,o=Object.keys(r.objects[r.state.frame]);l<o.length;l++){var c=o[l];r.objects[r.state.frame][c].resizeScale()}r.canvas.renderAll(),r.objectsToData(),r.updateHistory();var h=r.canvas.getActiveObject();setTimeout(function(){if(h)if(h instanceof U.fabric.ActiveSelection){var v=h.getObjects().map(function(p){return p.id});r.select(v,!0)}else r.select([h.id]);else r.select([])},100)},"mouse:move":function(l){var o=t.canvas.getPointer(l.e),c=t.state.uiWindow.ratio,h=Math.round(o.x*c),v=Math.round(o.y*c),p=document.getElementById("coordinateDisplay");p.style.display="block",p.textContent="x: ".concat(h,", y: ").concat(v)},"mouse:out":function(){var l=document.getElementById("coordinateDisplay");l.style.display="none"}}),setTimeout(function(){var a=t.his.get();t.props.setCouldDo(a),xe(a.now,function(l,o){return t.onObjectEvent(l,o)},function(l){return r.onFrameEvent("change",l)},function(){return t.canvas.renderAll()}).then(function(){t.setRobotId(),t.resetCanvasSize()}),t.cancelHistoryUpdate()},50),setTimeout(function(){var a=t.his.get();t.props.setCouldDo(a),xe(a.now,function(l,o){return t.onObjectEvent(l,o)},function(l){return r.onFrameEvent("change",l)},function(){return t.canvas.renderAll()}).then(function(){t.setRobotId(),t.resetCanvasSize()}),t.cancelHistoryUpdate()},200),window.dispatch=function(a,l){t.onObjectEvent(a,l)}}},{key:"upload",value:function(t){var r=this,a=this,l=new FileReader;l.onload=function(){var o=k()(x()().mark(function c(h){return x()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,a.reset();case 2:return p.next=4,xe(JSON.parse(h.target.result),function(d,g){return a.onObjectEvent(d,g)},function(d){return a.onFrameEvent("change",d)},function(){return a.canvas.renderAll()}).then(function(){r.setRobotId()});case 4:a.objectsToData(),a.his.reset({version:2,data:r.data,selected:r.state.frame});case 6:case"end":return p.stop()}},c)}));return function(c){return o.apply(this,arguments)}}(),l.readAsText(t)}},{key:"objectsToData",value:function(){for(var t=this,r={},a=0,l=Object.keys(this.objects);a<l.length;a++){var o=l[a];r[o]={};for(var c=0,h=Object.keys(this.objects[o]);c<h.length;c++){var v=h[c],p=this.objects[o][v].toObject();r[o][p.id]=p}}if(this.data=r,this.setState({data:r[this.state.frame]}),this.state.selectedId.length===1){var d;this.state.selectedId[0]===-2?d=this.state.uiWindow:d=r[this.state.frame][this.state.selectedId[0]],this.setState({properties:B()({},d)},function(){var g;(g=t.propertiesRef.current)===null||g===void 0||g.reload()})}}},{key:"onObjectEvent",value:function(t,r){var a=this;function l(p){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,g={id:p.id,name:p.name,layer:p.layer,group:p.group,type:p.type,ratio:a.state.uiWindow.ratio,team:a.state.uiWindow.team},y=kr(g);a.objects[a.state.frame][p.id]=y,d&&y.fromObject(p),y.setRatio(a.state.uiWindow.ratio);for(var M=a.canvas.getObjects(),j=!0,S=0,L=Object.keys(M);S<L.length;S++){var F=L[S];if(M[F].id===y.id){j=!1;break}}a.canvas.add(y)}if(t==="add")if(typeof r.id=="number"&&r.id>=0&&!this.objects[this.state.frame][r.id])l(r,!0);else return console.log("id exists",r.id,this.objects[this.state.frame][r.id]),"W: Adding Object ".concat(r.id," exists");else if(t==="_add")r.id=this.getNewDataId(),r.ratio=this.state.uiWindow.ratio,r.team=this.state.uiWindow.team,l(r,!1);else if(t==="update")if(this.objects[this.state.frame][r.id])this.objects[this.state.frame][r.id].fromObject(r);else return"E: Updating object ".concat(r.id," not exists");else if(t==="_update")r.id>=0&&this.objects[this.state.frame][r.id]?this.objects[this.state.frame][r.id].fromObject(r):l(r);else if(t==="remove"){var o=r.id;if(this.objects[this.state.frame][o])this.select([]),this.canvas.remove(this.objects[this.state.frame][o]),this.canvas.renderAll(),delete this.objects[this.state.frame][o],this.objectsToData();else return"E: Remove object ".concat(o," not exists")}else if(t==="setAttr")this.objects[this.state.frame][r.id]&&this.objects[this.state.frame][r.id].set(r.payload);else if(t==="removeLayer")for(var c=0,h=Object.keys(this.objects[this.state.frame]);c<h.length;c++){var v=h[c];this.objects[this.state.frame][v].layer===r.layer&&this.onObjectEvent("remove",{id:v})}else t==="removeAll"&&this.reset(!0);return this.objectsToData(),this.canvas.renderAll(),"S"}},{key:"setFrame",value:function(t){this.objects[t]||(this.objects[t]={});for(var r=0,a=Object.keys(this.objects[this.state.frame]);r<a.length;r++){var l=a[r];this.canvas.remove(this.objects[this.state.frame][l])}this.canvas.renderAll();var o=this;return new Promise(function(c,h){o.setState({frame:t},function(){for(var v=o.canvas.getObjects(),p=0,d=Object.keys(o.objects[o.state.frame]);p<d.length;p++){for(var g=d[p],y=!0,M=0,j=Object.keys(v);M<j.length;M++){var S=j[M];if(v[S].id===o.objects[o.state.frame][g].id){y=!1;break}}y&&o.canvas.add(o.objects[o.state.frame][g])}o.objectsToData(),o.select([]),o.canvas.renderAll(),c()})})}},{key:"onHistoryEvent",value:function(){var i=k()(x()().mark(function r(a){var l=this,o;return x()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(o=this.his.get(),a!=="update"){h.next=6;break}return this.updateHistory(),h.abrupt("return");case 6:if(a!=="reset"){h.next=12;break}return o=this.his.reset({version:2,data:{default:{}},selected:"default"}),this.props.setCouldDo(o),h.abrupt("return");case 12:if(a!=="resetNow"){h.next=16;break}return o=this.his.reset({version:2,data:this.data,selected:this.state.frame}),this.props.setCouldDo(o),h.abrupt("return");case 16:return a==="previous"?o=this.his.previous():a==="next"&&(o=this.his.next()),this.props.setCouldDo(o),h.next=20,this.reset(!0);case 20:return h.next=22,xe(o.now,function(v,p){return l.onObjectEvent(v,p)},function(v){return l.onFrameEvent("change",v)},function(){return l.canvas.renderAll()}).then(function(){l.setRobotId()});case 22:this.cancelHistoryUpdate(),this.props.setCouldDo(o);case 24:case"end":return h.stop()}},r,this)}));function t(r){return i.apply(this,arguments)}return t}()},{key:"onFrameEvent",value:function(){var i=k()(x()().mark(function r(a,l){var o,c,h,v,p,d;return x()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(a!=="add"){y.next=6;break}return this.objects[l]={},y.next=4,this.setFrame(l);case 4:y.next=40;break;case 6:if(a!=="remove"){y.next=19;break}if(Object.keys(this.objects).length!==1){y.next=10;break}return W.error("Cannot remove last frame!"),y.abrupt("return");case 10:if(o=l,this.state.frame!==l){y.next=16;break}return l=Object.keys(this.objects)[0],l===o&&(l=Object.keys(this.objects)[1]),y.next=16,this.setFrame(l);case 16:delete this.objects[o],y.next=40;break;case 19:if(a!=="change"){y.next=24;break}return y.next=22,this.setFrame(l);case 22:y.next=40;break;case 24:if(a!=="copy"){y.next=34;break}return this.objects[l]={},c=this.objects[this.state.frame],y.next=29,this.setFrame(l);case 29:for(h=0,v=Object.keys(c);h<v.length;h++)p=v[h],this.onObjectEvent("_update",c[p].toObject());this.objectsToData(),this.canvas.renderAll(),y.next=40;break;case 34:if(a!=="rename"){y.next=40;break}return d=this.state.frame,y.next=38,this.onFrameEvent("copy",l);case 38:return y.next=40,this.onFrameEvent("remove",d);case 40:this.props.onFrameChange({frames:Object.keys(this.objects),selected:l}),this.objectsToData(),this.updateHistory();case 43:case"end":return y.stop()}},r,this)}));function t(r,a){return i.apply(this,arguments)}return t}()},{key:"render",value:function(){var t,r=this;return(t=this.canvas)===null||t===void 0||t.renderAll(),(0,u.jsx)("div",{style:{width:"100vw",height:"calc(100% - 20px)",padding:10},children:(0,u.jsxs)(te.eh,{autoSaveId:"container_h",className:"container",direction:"horizontal",children:[(0,u.jsx)(te.s_,{defaultSize:25,minSize:15,maxSize:45,order:1,children:(0,u.jsxs)(te.eh,{autoSaveId:"card_v",className:"full",direction:"vertical",children:[(0,u.jsx)(te.s_,{defaultSize:50,minSize:25,maxSize:75,children:(0,u.jsx)(hr,{onSelect:function(l){return r.select(l)},onObjectEvent:function(l,o){return r.onObjectEvent(l,o)},onReset:function(){return r.reset()},data:this.state.data,editable:this.state.editable,selectedId:this.state.selectedId})}),(0,u.jsx)(te.OT,{className:"panel-resize-handle",style:{height:6}}),(0,u.jsx)(te.s_,{defaultSize:50,children:(0,u.jsx)(et.Z,{size:"small",title:"Properties",style:{height:"100%"},children:(0,u.jsxs)("div",{className:"card-body",children:[this.state.properties?(0,u.jsx)(tt.vY,{dataSource:this.state.properties,columns:ot(this.state.properties),ref:this.propertiesRef,editable:this.props.editable?{onSave:function(l,o){return r.onPropertiesChange(l,o)}}:null,column:1,style:{marginTop:4}},this.state.selectedId[0]):(0,u.jsx)(pe.Z,{image:pe.Z.PRESENTED_IMAGE_SIMPLE}),this.state.selectedId[0]===-2?(0,u.jsxs)(G.Z,{direction:"vertical",size:"middle",style:{display:"flex"},children:[(0,u.jsx)(C.ZP,{onClick:function(){return Ee("image/*").then(function(l){r.setState({imageUploadShow:!1}),r.setBackground(vr(l))}).catch(function(l){})},children:"Upload Background"}),(0,u.jsx)(C.ZP,{onClick:function(){return r.setBackground(m(25665))},children:"Reset Background"})]}):(0,u.jsx)("div",{})]})})})]})}),(0,u.jsx)(te.OT,{className:"panel-resize-handle",style:{width:6}}),(0,u.jsx)(te.s_,{defaultSize:75,order:2,onResize:function(l){return setTimeout(function(){return r.resetCanvasSize()},100)},children:(0,u.jsxs)("div",{className:"full",ref:this.canvasRef,children:[(0,u.jsx)("canvas",{className:"full",id:"ui"}),(0,u.jsx)("div",{id:"coordinateDisplay",style:{bottom:0,right:0,display:"none",padding:"1px 6px 1px 6px"}})]})})]})})}}]),n}(z.Component),Tr=Ar,Dr=m(13769),Le=m.n(Dr),be=m(22997),Or=m(74330),Me=m(85576),ft=m(92462),vt=m(553);function Er(){return Ue.apply(this,arguments)}function Ue(){return Ue=k()(x()().mark(function s(){var e,n,i,t,r,a,l,o,c,h,v,p,d;return x()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(!V()){y.next=14;break}return y.next=3,(0,ft.Py)();case 3:if(e=y.sent,!e.manifest){y.next=11;break}return n=e.manifest.version.slice(1).split(".").map(Number),i=localStorage.getItem("version_ignored"),i||(i="nightly 7dc1935"),t=i.slice(1).split(".").map(Number),r=n[0]>t[0]||n[1]>t[1]||n[2]>t[2],y.abrupt("return",{shouldUpdate:r,manifest:e.manifest});case 11:return y.abrupt("return",e);case 14:return a=Date.now(),y.next=17,fetch("https://ui.bismarck.xyz/update.json?".concat(a));case 17:return l=y.sent,y.next=20,l.json();case 20:return o=y.sent,c=o.notes,h=o.version.slice(1).split(".").map(Number),v=localStorage.getItem("version_ignored"),v||(v="nightly 7dc1935"),p=v.slice(1).split(".").map(Number),d=h[0]>p[0]||h[1]>p[1]||h[2]>p[2],y.abrupt("return",{shouldUpdate:d,manifest:{body:c,version:o.version}});case 28:case"end":return y.stop()}},s)})),Ue.apply(this,arguments)}function Nr(){return Ze.apply(this,arguments)}function Ze(){return Ze=k()(x()().mark(function s(){return x()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!V()){n.next=6;break}return n.next=3,(0,ft.F_)();case 3:return n.abrupt("return",n.sent);case 6:window.location.reload();case 7:case"end":return n.stop()}},s)})),Ze.apply(this,arguments)}var He={checkUpdate:Er,installUpdate:Nr,relaunch:vt.R},Pe=m(21798),Fr=["node"],ji=He.checkUpdate,Rr=He.installUpdate,Lr=He.relaunch,Ur=function(s){H()(n,s);var e=P()(n);function n(){var i;I()(this,n);for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return i=e.call.apply(e,[this].concat(r)),b()(w()(i),"state",{step:0,content:"",version:""}),i}return A()(n,[{key:"handleClose",value:function(){this.setState({step:0})}},{key:"handleOk",value:function(){var i=k()(x()().mark(function r(){return x()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.prev=0,this.setState({step:2}),l.next=4,Rr();case 4:if(l.t0=!V(),l.t0){l.next=9;break}return l.next=8,Lr();case 8:l.t0=!l.sent;case 9:if(!l.t0){l.next=11;break}this.setState({step:3});case 11:l.next=16;break;case 13:l.prev=13,l.t1=l.catch(0),this.setState({step:-1});case 16:case"end":return l.stop()}},r,this,[[0,13]])}));function t(){return i.apply(this,arguments)}return t}()},{key:"check",value:function(){var t=this;if(1)V()||k()(x()().mark(function l(){var o,c;return x()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.prev=0,v.next=3,fetch("/nightly/version?timestamp=".concat(new Date().getTime()));case 3:return o=v.sent,v.next=6,o.text();case 6:c=v.sent,c.trim()!=={NODE_ENV:"production",PUBLIC_PATH:"/nightly/"}.ref.slice(0,7)&&(t.setState({step:2}),setTimeout(k()(x()().mark(function p(){var d,g;return x()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,fetch("/nightly/version?timestamp=".concat(new Date().getTime()));case 2:return d=M.sent,M.next=5,d.text();case 5:g=M.sent,g.trim()==="no"?window.location.href="/":window.location.reload();case 7:case"end":return M.stop()}},p)})),3e3)),v.next=13;break;case 10:v.prev=10,v.t0=v.catch(0),W.warning("Failed to check nightly version.");case 13:case"end":return v.stop()}},l,null,[[0,10]])}))();else var r,a}},{key:"ignore",value:function(){localStorage.setItem("version_ignored",this.state.version),this.handleClose()}},{key:"componentDidMount",value:function(){this.check()}},{key:"render",value:function(){var t=(0,u.jsx)("div",{});return this.state.step===-1?t=(0,u.jsx)(be.ZP,{status:"error",title:"Update Failed"}):this.state.step===1?t=(0,u.jsx)(Pe.U,{components:{a:function(a){var l=a.node,o=Le()(a,Fr);return(0,u.jsx)("a",B()(B()({},o),{},{target:"_blank"}))}},children:this.state.content}):this.state.step===2?t=(0,u.jsx)("div",{style:{padding:40,textAlign:"center",color:"var(--ant-color-text)"},children:(0,u.jsxs)(G.Z,{direction:"vertical",children:[(0,u.jsx)(Or.Z,{size:"large"}),(0,u.jsx)("h3",{children:"Updating..."})]})}):this.state.step===3&&(t=(0,u.jsx)(be.ZP,{status:"success",title:"Update Success",subTitle:"Please restart the app to apply the update."})),(0,u.jsx)(Me.Z,{title:"Auto Update",open:this.state.step,closable:this.state.step>1,maskClosable:this.state.step>1,zIndex:2100,footer:this.state.step===1?(0,u.jsxs)(G.Z,{children:[(0,u.jsx)(C.ZP,{onClick:this.ignore.bind(this),children:"Ignore"}),(0,u.jsx)(C.ZP,{onClick:this.handleClose.bind(this),children:"Cancel"}),(0,u.jsx)(C.ZP,{type:"primary",onClick:this.handleOk.bind(this),children:"Update"})]}):null,children:t})}}]),n}(z.Component),Zr=Ur,Be=m(40249),Hr=["node"],Pr=function(s){H()(n,s);var e=P()(n);function n(){var i;I()(this,n);for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return i=e.call.apply(e,[this].concat(r)),b()(w()(i),"state",{open:!1,content:null}),i}return A()(n,[{key:"componentDidMount",value:function(){var t=this,r=localStorage.getItem("eula");(!r||!JSON.parse(r))&&(this.setState({open:!0}),fetch(m(19293)).then(function(a){return a.text()}).then(function(a){t.setState({content:a})}))}},{key:"dontShow",value:function(){localStorage.setItem("eula","true"),this.setState({open:!1})}},{key:"render",value:function(){var t=this;return(0,u.jsx)(Me.Z,{title:"Welcome to RM UI Designer!",onOk:function(){return t.setState({open:!1})},onCancel:function(){return t.setState({open:!1})},footer:(0,u.jsxs)(G.Z,{children:[(0,u.jsx)(C.ZP,{onClick:this.dontShow.bind(this),children:"Don't show"}),(0,u.jsx)(C.ZP,{type:"primary",onClick:function(){return t.setState({open:!1})},children:"OK"})]}),open:this.state.open,zIndex:2200,children:this.state.content?(0,u.jsx)(Pe.U,{components:{a:function(a){var l=a.node,o=Le()(a,Hr);return(0,u.jsx)("a",B()(B()({},o),{},{target:"_blank"}))}},children:this.state.content}):(0,u.jsx)(Be.Z,{})})}}]),n}(z.Component),Br=Pr,Wr=m(40411),pt=m(8791),Yr=m(28100),$r=m(1944),Gr=m(39104),Qr=m(37388),Vr=m(73475),mt=m(16165),gt=m(49333),Jr=m(47745),Kr=function(s){H()(n,s);var e=P()(n);function n(){var i;I()(this,n);for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return i=e.call.apply(e,[this].concat(r)),b()(w()(i),"state",{title:"",open:!1,frames:[]}),b()(w()(i),"promise",null),i}return A()(n,[{key:"open",value:function(t,r){var a=this;return new Promise(function(l,o){a.setState({title:t,open:!0,frames:r}),a.promise&&a.promise.reject(),a.promise={resolve:l,reject:o}})}},{key:"render",value:function(){var t=this;return(0,u.jsx)(gt.Y,{title:this.state.title,autoFocusFirstInput:!0,width:240,open:this.state.open,onOpenChange:function(a){t.promise&&!a&&t.state.open&&t.promise.reject(),t.setState({open:a})},onFinish:function(){var r=k()(x()().mark(function a(l){return x()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return t.promise.resolve(l.frame),t.promise=null,c.abrupt("return",!0);case 3:case"end":return c.stop()}},a)}));return function(a){return r.apply(this,arguments)}}(),children:(0,u.jsx)(Jr.Z,{name:"frame",label:"New Frame Name",width:"sm",rules:[{required:!0,message:"Please input frame name!"},function(r){var a=r.getFieldValue,l=t;return{validator:function(c,h){{var v=!0,p=a("frame"),d=O()(l.state.frames),g;try{for(d.s();!(g=d.n()).done;){var y=g.value;if(y===p){v=!1;break}}}catch(M){d.e(M)}finally{d.f()}return v?Promise.resolve():Promise.reject(new Error("Cannot create same name frame!"))}}}}]})})}}]),n}(z.Component),Xr=Kr,qr=["node"],_r=function(s){H()(n,s);var e=P()(n);function n(){var i;I()(this,n);for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return i=e.call.apply(e,[this].concat(r)),b()(w()(i),"state",{open:!1,content:null}),i}return A()(n,[{key:"show",value:function(){this.setState({open:!0})}},{key:"componentDidMount",value:function(){var t=this;fetch(m(99734)).then(function(r){return r.text()}).then(function(r){t.setState({content:r})})}},{key:"render",value:function(){var t=this;return(0,u.jsx)(Me.Z,{title:"About",onOk:function(){return t.setState({open:!1})},onCancel:function(){return t.setState({open:!1})},footer:null,open:this.state.open,children:this.state.content?(0,u.jsx)(Pe.U,{components:{a:function(a){var l=a.node,o=Le()(a,qr);return(0,u.jsx)("a",B()(B()({},o),{},{target:"_blank"}))}},children:this.state.content}):(0,u.jsx)(Be.Z,{})})}}]),n}(z.Component),ea=_r,oe=m(96074),ta=m(5574),ra=m.n(ta),yt=function(){function s(e){I()(this,s),b()(this,"getContentFunc",void 0),b()(this,"fileHandle",void 0),b()(this,"timerId",void 0),b()(this,"updateTimerId",void 0),this.getContentFunc=e,this.fileHandle=null,this.timerId=null,this.updateTimerId=null}return A()(s,[{key:"open",value:function(){var e=k()(x()().mark(function i(){var t,r,a,l,o;return x()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(this.fileHandle=null,h.prev=1,!V()){h.next=9;break}return h.next=5,X.WZ.open({multiple:!1,directory:!1,filters:[{name:"rmui file",extensions:["json","rmui"]}]});case 5:t=h.sent,t!==null&&t.length>0&&typeof t=="string"&&(this.fileHandle=t.replace(/\\/g,"/"),r=this.fileHandle.split("/").pop(),document.title="".concat(r," - RM UI Designer")),h.next=18;break;case 9:return h.next=11,window.showOpenFilePicker({types:[{description:"rmui file",accept:{"application/json":[".json",".rmui"]}}]});case 11:return a=h.sent,l=ra()(a,1),this.fileHandle=l[0],h.next=16,this.fileHandle.getFile();case 16:o=h.sent.name,document.title="".concat(o," - RM UI Designer");case 18:this.enableAutoSave(),h.next=23;break;case 21:h.prev=21,h.t0=h.catch(1);case 23:return h.abrupt("return",this.fileHandle!==null);case 24:case"end":return h.stop()}},i,this,[[1,21]])}));function n(){return e.apply(this,arguments)}return n}()},{key:"create",value:function(){var e=k()(x()().mark(function i(){var t,r,a;return x()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(this.fileHandle=null,o.prev=1,!V()){o.next=9;break}return o.next=5,X.WZ.save({filters:[{name:"rmui file",extensions:["rmui"]}]});case 5:t=o.sent,t!==null&&(this.fileHandle=t.replace(/\\/g,"/"),r=this.fileHandle.split("/").pop(),document.title="".concat(r," - RM UI Designer")),o.next=16;break;case 9:return o.next=11,window.showSaveFilePicker({types:[{description:"rmui file",accept:{"application/json":[".rmui"]}}]});case 11:return this.fileHandle=o.sent,o.next=14,this.fileHandle.getFile();case 14:a=o.sent.name,document.title="".concat(a," - RM UI Designer");case 16:return o.next=18,this.write(JSON.stringify({version:2,data:{default:{}},selected:"default"}));case 18:this.enableAutoSave(),o.next=23;break;case 21:o.prev=21,o.t0=o.catch(1);case 23:return o.abrupt("return",this.fileHandle!==null);case 24:case"end":return o.stop()}},i,this,[[1,21]])}));function n(){return e.apply(this,arguments)}return n}()},{key:"enableAutoSave",value:function(){var n=this;this.timerId=setInterval(k()(x()().mark(function i(){var t;return x()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return t=n.getContentFunc(),a.next=3,n.write(t);case 3:case"end":return a.stop()}},i)})),6e4),W.success("Auto save enabled")}},{key:"disableAutoSave",value:function(){var e=k()(x()().mark(function i(){return x()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.save();case 2:this.timerId&&(clearInterval(this.timerId),this.timerId=null),this.updateTimerId&&(clearTimeout(this.updateTimerId),this.updateTimerId=null),W.warning("Auto save disabled");case 5:case"end":return r.stop()}},i,this)}));function n(){return e.apply(this,arguments)}return n}()},{key:"update",value:function(){var n=this;this.timerId!==null&&(this.updateTimerId!==null&&(clearTimeout(this.updateTimerId),this.updateTimerId=null),this.updateTimerId=setTimeout(k()(x()().mark(function i(){var t;return x()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return t=n.getContentFunc(),a.next=3,n.write(t);case 3:case"end":return a.stop()}},i)})),2e3))}},{key:"save",value:function(){var e=k()(x()().mark(function i(){var t;return x()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return t=this.getContentFunc(),a.next=3,this.write(t);case 3:case"end":return a.stop()}},i,this)}));function n(){return e.apply(this,arguments)}return n}()},{key:"write",value:function(){var e=k()(x()().mark(function i(t){var r;return x()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(this.fileHandle){l.next=2;break}throw new Error("File is not open");case 2:if(typeof this.fileHandle!="string"){l.next=7;break}return l.next=5,X.fs.writeTextFile(this.fileHandle,t);case 5:l.next=14;break;case 7:return l.next=9,this.fileHandle.createWritable();case 9:return r=l.sent,l.next=12,r.write(t);case 12:return l.next=14,r.close();case 14:case"end":return l.stop()}},i,this)}));function n(i){return e.apply(this,arguments)}return n}()},{key:"read",value:function(){var e=k()(x()().mark(function i(){var t,r;return x()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(this.fileHandle){l.next=2;break}throw new Error("File is not open");case 2:if(typeof this.fileHandle!="string"){l.next=10;break}return l.next=5,X.fs.readTextFile(this.fileHandle);case 5:return t=l.sent,r=new Blob([t],{type:"text/plain;charset=utf-8"}),l.abrupt("return",new File([r],this.fileHandle));case 10:return l.next=12,this.fileHandle.getFile();case 12:return l.abrupt("return",l.sent);case 13:case"end":return l.stop()}},i,this)}));function n(){return e.apply(this,arguments)}return n}()}]),s}();function aa(){return"showOpenFilePicker"in window||V()}var ia=function(s){H()(n,s);var e=P()(n);function n(){var i;I()(this,n);for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return i=e.call.apply(e,[this].concat(r)),b()(w()(i),"state",{title:"",open:!1,frames:[]}),b()(w()(i),"promise",null),i}return A()(n,[{key:"open",value:function(){var t=this;return new Promise(function(r,a){t.setState({open:!0}),t.promise&&t.promise.reject(),t.promise={resolve:r,reject:a}})}},{key:"onClick",value:function(t){this.setState({open:!1}),this.promise.resolve(t),this.promise=null}},{key:"render",value:function(){var t=this,r=aa();return(0,u.jsx)(Me.Z,{footer:null,maskClosable:!1,closeIcon:null,zIndex:2050,open:this.state.open,children:(0,u.jsxs)(G.Z,{direction:"vertical",size:"middle",style:{width:"100%",padding:15},children:[(0,u.jsx)(C.ZP,{type:"primary",disabled:!r,style:{width:"100%"},size:"large",onClick:function(){return t.onClick("new")},children:"New Project"}),(0,u.jsx)(C.ZP,{type:"primary",disabled:!r,style:{width:"100%"},size:"large",onClick:function(){return t.onClick("open")},children:"Open Exist"}),(0,u.jsx)(oe.Z,{}),(0,u.jsx)(C.ZP,{type:"primary",style:{width:"100%"},size:"large",onClick:function(){return t.onClick("use")},children:"Temporary Use"})]})})}}]),n}(z.Component),sa=ia,na=Object.defineProperty,xt=Object.getOwnPropertySymbols,la=Object.prototype.hasOwnProperty,oa=Object.prototype.propertyIsEnumerable,bt=(s,e,n)=>e in s?na(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n,ua=(s,e)=>{for(var n in e||(e={}))la.call(e,n)&&bt(s,n,e[n]);if(xt)for(var n of xt(e))oa.call(e,n)&&bt(s,n,e[n]);return s};const ca=s=>z.createElement("svg",ua({className:"moon_svg__icon",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",width:200,height:200},s),z.createElement("path",{d:"M472 991.6c-157 0-304.4-77.2-394.3-206.6-6.9-9.9-7.6-22.9-1.8-33.6 5.8-10.7 17.1-17.8 29.2-16.7l7.7.4c2.4.2 4.8.3 7.2.3 229.4 0 416-186.6 416-416 0-85-25.7-167-74.3-236.9-6.9-9.9-7.6-22.9-1.8-33.6 5.8-10.7 17.2-17.6 29.2-16.7C748.7 41.6 952 252.1 952 511.6c0 264.7-215.3 480-480 480zM169.7 797.1c78.1 82.7 187.2 130.6 302.3 130.6 229.4 0 416-186.6 416-416 0-204-144.9-373-339.7-408.6 34 66.9 51.7 140.7 51.7 216.6 0 247.8-188.9 452.4-430.3 477.4z",fill:"#2c2c2c"}));var zi="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PHBhdGggZD0iTTQ3MiA5OTEuNmMtMTU3IDAtMzA0LjQtNzcuMi0zOTQuMy0yMDYuNi02LjktOS45LTcuNi0yMi45LTEuOC0zMy42IDUuOC0xMC43IDE3LjEtMTcuOCAyOS4yLTE2LjdsNy43LjRjMi40LjIgNC44LjMgNy4yLjMgMjI5LjQgMCA0MTYtMTg2LjYgNDE2LTQxNiAwLTg1LTI1LjctMTY3LTc0LjMtMjM2LjktNi45LTkuOS03LjYtMjIuOS0xLjgtMzMuNiA1LjgtMTAuNyAxNy4yLTE3LjYgMjkuMi0xNi43Qzc0OC43IDQxLjYgOTUyIDI1Mi4xIDk1MiA1MTEuNmMwIDI2NC43LTIxNS4zIDQ4MC00ODAgNDgwek0xNjkuNyA3OTcuMWM3OC4xIDgyLjcgMTg3LjIgMTMwLjYgMzAyLjMgMTMwLjYgMjI5LjQgMCA0MTYtMTg2LjYgNDE2LTQxNiAwLTIwNC0xNDQuOS0zNzMtMzM5LjctNDA4LjYgMzQgNjYuOSA1MS43IDE0MC43IDUxLjcgMjE2LjYgMCAyNDcuOC0xODguOSA0NTIuNC00MzAuMyA0NzcuNHoiIGZpbGw9IiMyYzJjMmMiLz48L3N2Zz4=",ha=Object.defineProperty,Mt=Object.getOwnPropertySymbols,da=Object.prototype.hasOwnProperty,fa=Object.prototype.propertyIsEnumerable,wt=(s,e,n)=>e in s?ha(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n,va=(s,e)=>{for(var n in e||(e={}))da.call(e,n)&&wt(s,n,e[n]);if(Mt)for(var n of Mt(e))fa.call(e,n)&&wt(s,n,e[n]);return s};const pa=s=>z.createElement("svg",va({className:"sun_svg__icon",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",width:200,height:200},s),z.createElement("path",{d:"M522.88 874.667A21.333 21.333 0 0 1 544.213 896v85.333a21.333 21.333 0 0 1-21.333 21.334h-21.333a21.333 21.333 0 0 1-21.334-21.334V896a21.333 21.333 0 0 1 21.334-21.333h21.333zm268.416-107.52 60.352 60.352a21.333 21.333 0 0 1 0 30.165l-15.083 15.083a21.333 21.333 0 0 1-30.186 0l-60.331-60.352a21.333 21.333 0 0 1 0-30.166l15.083-15.082a21.333 21.333 0 0 1 30.165 0zm-527.957 0 15.082 15.082a21.333 21.333 0 0 1 0 30.166l-60.352 60.352a21.333 21.333 0 0 1-30.165 0l-15.083-15.083a21.333 21.333 0 0 1 0-30.165l60.331-60.352a21.333 21.333 0 0 1 30.187 0zM512 277.333c141.376 0 256 114.624 256 256s-114.624 256-256 256-256-114.624-256-256 114.624-256 256-256zm0 64a192 192 0 1 0 0 384 192 192 0 0 0 0-384zm448.213 160a21.333 21.333 0 0 1 21.334 21.334V544a21.333 21.333 0 0 1-21.334 21.333H874.88A21.333 21.333 0 0 1 853.547 544v-21.333a21.333 21.333 0 0 1 21.333-21.334h85.333zm-810.666 0a21.333 21.333 0 0 1 21.333 21.334V544a21.333 21.333 0 0 1-21.333 21.333H64.213A21.333 21.333 0 0 1 42.88 544v-21.333a21.333 21.333 0 0 1 21.333-21.334h85.334zm687.04-307.413 15.082 15.083a21.333 21.333 0 0 1 0 30.165l-60.352 60.352a21.333 21.333 0 0 1-30.165 0l-15.083-15.083a21.333 21.333 0 0 1 0-30.165L806.4 193.92a21.333 21.333 0 0 1 30.187 0zm-618.496 0 60.352 60.352a21.333 21.333 0 0 1 0 30.165L263.36 299.52a21.333 21.333 0 0 1-30.187 0l-60.352-60.373a21.333 21.333 0 0 1 0-30.166l15.083-15.082a21.333 21.333 0 0 1 30.165 0zM522.9 64a21.333 21.333 0 0 1 21.334 21.333v85.334A21.333 21.333 0 0 1 522.9 192h-21.333a21.333 21.333 0 0 1-21.333-21.333V85.333A21.333 21.333 0 0 1 501.568 64h21.333z",fill:"#ebebeb"}));var Ci="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PHBhdGggZD0iTTUyMi44OCA4NzQuNjY3QTIxLjMzMyAyMS4zMzMgMCAwIDEgNTQ0LjIxMyA4OTZ2ODUuMzMzYTIxLjMzMyAyMS4zMzMgMCAwIDEtMjEuMzMzIDIxLjMzNGgtMjEuMzMzYTIxLjMzMyAyMS4zMzMgMCAwIDEtMjEuMzM0LTIxLjMzNFY4OTZhMjEuMzMzIDIxLjMzMyAwIDAgMSAyMS4zMzQtMjEuMzMzaDIxLjMzM3ptMjY4LjQxNi0xMDcuNTIgNjAuMzUyIDYwLjM1MmEyMS4zMzMgMjEuMzMzIDAgMCAxIDAgMzAuMTY1bC0xNS4wODMgMTUuMDgzYTIxLjMzMyAyMS4zMzMgMCAwIDEtMzAuMTg2IDBsLTYwLjMzMS02MC4zNTJhMjEuMzMzIDIxLjMzMyAwIDAgMSAwLTMwLjE2NmwxNS4wODMtMTUuMDgyYTIxLjMzMyAyMS4zMzMgMCAwIDEgMzAuMTY1IDB6bS01MjcuOTU3IDAgMTUuMDgyIDE1LjA4MmEyMS4zMzMgMjEuMzMzIDAgMCAxIDAgMzAuMTY2bC02MC4zNTIgNjAuMzUyYTIxLjMzMyAyMS4zMzMgMCAwIDEtMzAuMTY1IDBsLTE1LjA4My0xNS4wODNhMjEuMzMzIDIxLjMzMyAwIDAgMSAwLTMwLjE2NWw2MC4zMzEtNjAuMzUyYTIxLjMzMyAyMS4zMzMgMCAwIDEgMzAuMTg3IDB6TTUxMiAyNzcuMzMzYzE0MS4zNzYgMCAyNTYgMTE0LjYyNCAyNTYgMjU2cy0xMTQuNjI0IDI1Ni0yNTYgMjU2LTI1Ni0xMTQuNjI0LTI1Ni0yNTYgMTE0LjYyNC0yNTYgMjU2LTI1NnptMCA2NGExOTIgMTkyIDAgMSAwIDAgMzg0IDE5MiAxOTIgMCAwIDAgMC0zODR6bTQ0OC4yMTMgMTYwYTIxLjMzMyAyMS4zMzMgMCAwIDEgMjEuMzM0IDIxLjMzNFY1NDRhMjEuMzMzIDIxLjMzMyAwIDAgMS0yMS4zMzQgMjEuMzMzSDg3NC44OEEyMS4zMzMgMjEuMzMzIDAgMCAxIDg1My41NDcgNTQ0di0yMS4zMzNhMjEuMzMzIDIxLjMzMyAwIDAgMSAyMS4zMzMtMjEuMzM0aDg1LjMzM3ptLTgxMC42NjYgMGEyMS4zMzMgMjEuMzMzIDAgMCAxIDIxLjMzMyAyMS4zMzRWNTQ0YTIxLjMzMyAyMS4zMzMgMCAwIDEtMjEuMzMzIDIxLjMzM0g2NC4yMTNBMjEuMzMzIDIxLjMzMyAwIDAgMSA0Mi44OCA1NDR2LTIxLjMzM2EyMS4zMzMgMjEuMzMzIDAgMCAxIDIxLjMzMy0yMS4zMzRoODUuMzM0em02ODcuMDQtMzA3LjQxMyAxNS4wODIgMTUuMDgzYTIxLjMzMyAyMS4zMzMgMCAwIDEgMCAzMC4xNjVsLTYwLjM1MiA2MC4zNTJhMjEuMzMzIDIxLjMzMyAwIDAgMS0zMC4xNjUgMGwtMTUuMDgzLTE1LjA4M2EyMS4zMzMgMjEuMzMzIDAgMCAxIDAtMzAuMTY1TDgwNi40IDE5My45MmEyMS4zMzMgMjEuMzMzIDAgMCAxIDMwLjE4NyAwem0tNjE4LjQ5NiAwIDYwLjM1MiA2MC4zNTJhMjEuMzMzIDIxLjMzMyAwIDAgMSAwIDMwLjE2NUwyNjMuMzYgMjk5LjUyYTIxLjMzMyAyMS4zMzMgMCAwIDEtMzAuMTg3IDBsLTYwLjM1Mi02MC4zNzNhMjEuMzMzIDIxLjMzMyAwIDAgMSAwLTMwLjE2NmwxNS4wODMtMTUuMDgyYTIxLjMzMyAyMS4zMzMgMCAwIDEgMzAuMTY1IDB6TTUyMi45IDY0YTIxLjMzMyAyMS4zMzMgMCAwIDEgMjEuMzM0IDIxLjMzM3Y4NS4zMzRBMjEuMzMzIDIxLjMzMyAwIDAgMSA1MjIuOSAxOTJoLTIxLjMzM2EyMS4zMzMgMjEuMzMzIDAgMCAxLTIxLjMzMy0yMS4zMzNWODUuMzMzQTIxLjMzMyAyMS4zMzMgMCAwIDEgNTAxLjU2OCA2NGgyMS4zMzN6IiBmaWxsPSIjZWJlYmViIi8+PC9zdmc+",ue=m(25641),ma=[1152e3,1e6,921600,576e3,5e5,460800,230400,115200,74800,57600,38400,19200,9600,4800],ga=function(s){H()(n,s);var e=P()(n);function n(){var i;I()(this,n);for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return i=e.call.apply(e,[this].concat(r)),b()(w()(i),"state",{open:!1,defaultOptions:{}}),b()(w()(i),"promise",null),i}return A()(n,[{key:"getOptions",value:function(t){var r=this;return new Promise(function(a,l){r.setState({open:!0,defaultOptions:t}),r.promise&&r.promise.reject(),r.promise={resolve:a,reject:l}})}},{key:"onFinish",value:function(){var i=k()(x()().mark(function r(a){return x()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.promise.resolve(a),this.promise=null,o.abrupt("return",!0);case 3:case"end":return o.stop()}},r,this)}));function t(r){return i.apply(this,arguments)}return t}()},{key:"render",value:function(){var t=this;return(0,u.jsxs)(gt.Y,{title:"Serial",width:400,open:this.state.open,onOpenChange:function(a){return t.setState({open:a})},onFinish:function(){var r=k()(x()().mark(function a(l){return x()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,t.onFinish(l);case 2:return c.abrupt("return",c.sent);case 3:case"end":return c.stop()}},a)}));return function(a){return r.apply(this,arguments)}}(),children:[(0,u.jsx)(ue.Z,{name:"baudRate",label:"Baud Rate",width:"sm",initialValue:this.state.defaultOptions.baudRate,options:ma.map(function(r){return{value:r,label:r.toString()}}),rules:[{required:!0}]}),(0,u.jsx)(ue.Z,{name:"dataBits",label:"Data Bits",width:"sm",initialValue:this.state.defaultOptions.dataBits,options:[{value:8,label:"8"},{value:7,label:"7"}],rules:[{required:!0}]}),(0,u.jsx)(ue.Z,{name:"stopBits",label:"Stop Bits",width:"sm",initialValue:this.state.defaultOptions.stopBits,options:[{value:1,label:"1"},{value:2,label:"2"}],rules:[{required:!0}]}),(0,u.jsx)(ue.Z,{name:"parity",label:"Parity",width:"sm",initialValue:this.state.defaultOptions.parity,options:[{value:"none",label:"None"},{value:"even",label:"Even"},{value:"odd",label:"Odd"}],rules:[{required:!0}]}),(0,u.jsx)(ue.Z,{name:"flowControl",label:"Flow Control",width:"sm",initialValue:this.state.defaultOptions.flowControl,options:[{value:"none",label:"None"},{value:"hardware",label:"Hardware"}],rules:[{required:!0}]})]})}}]),n}(z.Component),ya=ga,we=m(2487),ke=m(42477),kt=m(78977),St=m(97309),xa=function(s){H()(n,s);var e=P()(n);function n(){var i;I()(this,n);for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return i=e.call.apply(e,[this].concat(r)),b()(w()(i),"state",{show:!1,errors:[]}),i}return A()(n,[{key:"onClose",value:function(){this.setState({show:!1})}},{key:"show",value:function(t){this.setState({show:!0,errors:t})}},{key:"render",value:function(){var t=this,r=this.state.errors.filter(function(o){return o.level==="warn"}),a=this.state.errors.filter(function(o){return o.level==="error"}),l=(0,u.jsx)(be.ZP,{status:"success",title:"0 error, 0 warning!",style:{marginTop:"50px"}});return a.length+r.length>0&&(l=(0,u.jsxs)("div",{style:{color:"var(--ant-color-text)",height:"100%"},children:[(0,u.jsxs)("p",{children:["Logged ",a.length," errors, ",r.length," warnings."]}),(0,u.jsx)("div",{style:{paddingBottom:10},className:"card-body",children:(0,u.jsx)(we.Z,{bordered:!0,dataSource:this.state.errors,renderItem:function(c){return(0,u.jsx)(we.Z.Item,{children:(0,u.jsxs)(G.Z,{size:"middle",children:[c.level==="warn"?(0,u.jsx)(kt.Z,{}):(0,u.jsx)(St.Z,{}),"".concat(c.time.toLocaleTimeString(),": ").concat(c.message)]})})}})})]})),(0,u.jsx)(ke.Z,{title:"Serial Debug Log",placement:"right",onClose:function(){return t.onClose()},open:this.state.show,size:"large",getContainer:document.getElementById("content-in"),rootStyle:{inset:"25px 0 0 0"},style:{borderTop:"3px var(--ant-line-type) var(--ant-color-split)"},children:(0,u.jsx)("div",{style:{width:"100%",height:"calc(100% - 25px)"},children:l})})}}]),n}(z.Component),ba=xa,We=m(66309),Ma=m(55241),wa=[0,94,188,226,97,63,221,131,194,156,126,32,163,253,31,65,157,195,33,127,252,162,64,30,95,1,227,189,62,96,130,220,35,125,159,193,66,28,254,160,225,191,93,3,128,222,60,98,190,224,2,92,223,129,99,61,124,34,192,158,29,67,161,255,70,24,250,164,39,121,155,197,132,218,56,102,229,187,89,7,219,133,103,57,186,228,6,88,25,71,165,251,120,38,196,154,101,59,217,135,4,90,184,230,167,249,27,69,198,152,122,36,248,166,68,26,153,199,37,123,58,100,134,216,91,5,231,185,140,210,48,110,237,179,81,15,78,16,242,172,47,113,147,205,17,79,173,243,112,46,204,146,211,141,111,49,178,236,14,80,175,241,19,77,206,144,114,44,109,51,209,143,12,82,176,238,50,108,142,208,83,13,239,177,240,174,76,18,145,207,45,115,202,148,118,40,171,245,23,73,8,86,180,234,105,55,213,139,87,9,235,181,54,104,138,212,149,203,41,119,244,170,72,22,233,183,85,11,136,214,52,106,43,117,151,201,74,20,246,168,116,42,200,150,21,75,169,247,182,232,10,84,215,137,107,53];function ce(s){for(var e=255,n=0,i,t=s.byteLength;t--;)i=e^s[n],e=wa[i],n++;return e}var ka=[0,4489,8978,12955,17956,22445,25910,29887,35912,40385,44890,48851,51820,56293,59774,63735,4225,264,13203,8730,22181,18220,30135,25662,40137,36160,49115,44626,56045,52068,63999,59510,8450,12427,528,5017,26406,30383,17460,21949,44362,48323,36440,40913,60270,64231,51324,55797,12675,8202,4753,792,30631,26158,21685,17724,48587,44098,40665,36688,64495,60006,55549,51572,16900,21389,24854,28831,1056,5545,10034,14011,52812,57285,60766,64727,34920,39393,43898,47859,21125,17164,29079,24606,5281,1320,14259,9786,57037,53060,64991,60502,39145,35168,48123,43634,25350,29327,16404,20893,9506,13483,1584,6073,61262,65223,52316,56789,43370,47331,35448,39921,29575,25102,20629,16668,13731,9258,5809,1848,65487,60998,56541,52564,47595,43106,39673,35696,33800,38273,42778,46739,49708,54181,57662,61623,2112,6601,11090,15067,20068,24557,28022,31999,38025,34048,47003,42514,53933,49956,61887,57398,6337,2376,15315,10842,24293,20332,32247,27774,42250,46211,34328,38801,58158,62119,49212,53685,10562,14539,2640,7129,28518,32495,19572,24061,46475,41986,38553,34576,62383,57894,53437,49460,14787,10314,6865,2904,32743,28270,23797,19836,50700,55173,58654,62615,32808,37281,41786,45747,19012,23501,26966,30943,3168,7657,12146,16123,54925,50948,62879,58390,37033,33056,46011,41522,23237,19276,31191,26718,7393,3432,16371,11898,59150,63111,50204,54677,41258,45219,33336,37809,27462,31439,18516,23005,11618,15595,3696,8185,63375,58886,54429,50452,45483,40994,37561,33584,31687,27214,22741,18780,15843,11370,7921,3960];function he(s){for(var e=65535,n,i=0,t=s.byteLength;t--;)n=s[i],e=e>>8^ka[(e^n)&255],i++;return e}var le=["UiLine","UiRect","UiRound","UiEllipse","UiArc","UiFloat","UiNumber","UiText"],Ye=["main","yellow","green","orange","purple","pink","cyan","black","white"],$e=["null","add","update","remove"],jt={257:1,258:2,259:5,260:7},Sa=["null","removeLayer","removeAll"];function Ge(s,e){return s[e]|s[e+1]<<8}function Qe(s,e){return s[e]|s[e+1]<<8|s[e+2]<<16|s[e+3]<<24}function zt(s){var e=0,n=s[e++],i=s[e++],t="".concat(n,"-").concat(i),r=s[e++]|i<<8|n<<16,a=Qe(s,e);e+=4;var l=a&7,o=a>>3&7,c=a>>6&15,h=a>>10&15,v=a>>14&511,p=a>>23&511,d=Qe(s,e);e+=4;var g=d&1023,y=d>>10&2047,M=d>>21&2047,j=Qe(s,e),S=j&1023,L=j>>10&2047,F=j>>21&2047;return{group:t,id:r,operate_tpyel:l,figure_tpye:o,layer:c,color:h,_a:v,_b:p,width:g,start_x:y,start_y:M,_c:S,_d:L,_e:F,number:j}}function Ct(s){var e=Ge(s,0),n=Ge(s,2),i=Ge(s,4),t=[];if(e===256)t.push({type:Sa[s[6]],obj:{layer:s[7]}});else if(e===272){var r=zt(s.subarray(6,21)),a=String.fromCharCode.apply(String,E()(s.subarray(21,21+r._b)));t.push({type:$e[r.operate_tpyel],obj:{layer:r.layer,group:r.group,type:le[r.figure_tpye],id:r.id,name:"".concat(le[r.figure_tpye],"_").concat(r.id&255),color:Ye[r.color],lineWidth:r.width,x:r.start_x,y:r.start_y,fontSize:r._a,text:a,_start:6,_end:s.length}})}else if(e in jt)for(var l=jt[e],o=0;o<l;o++){var c=zt(s.subarray(6+o*15,6+(o+1)*15)),h={layer:c.layer,group:c.group,type:le[c.figure_tpye],id:c.id,name:"".concat(le[c.figure_tpye],"_").concat(c.id&255),color:Ye[c.color],lineWidth:c.width,x:c.start_x,y:c.start_y,_start:6+o*15,_end:6+(o+1)*15};switch(le[c.figure_tpye].slice(2)){case"Line":h.x2=c._d,h.y2=c._e;break;case"Rect":h.width=c._d-c.start_x,h.height=c._e-c.start_y;break;case"Round":h.r=c._c;break;case"Ellipse":h.rx=c._d,h.ry=c._e;break;case"Arc":h.startAngle=c._a,h.endAngle=c._b,h.rx=c._d,h.ry=c._e;break;case"Float":h.fontSize=c._a,h.float=c.number/1e3;break;case"Number":h.fontSize=c._a,h.number=c.number;break}t.push({type:$e[c.operate_tpyel],obj:h})}else console.log("unknown sub_id",e);return{sender:n,receiver:i,sub_id:e,events:t}}function ja(s){var e=[8,21,36,81,111,51];if(s[0]!==165)return{code:1,error:"Message must start with 0xA5",loc:[0]};if(s.length<7)return{code:2,error:"Message length must be at least 7 bytes",loc:[0]};var n=s[1]|s[2]<<8,i=s[3],t=s[4],r=s[5]|s[6]<<8,a=s.subarray(0,4);if(ce(a)!==t)return{code:3,error:"crc8 error, calc: 0x".concat(ce(a).toString(16),", msg: 0x").concat(t.toString(16)),loc:[4]};if(r!==769)return{code:4,error:"cmd_id 0x".concat(r.toString(16)," not match"),loc:[5,6]};if(!e.includes(n))return{code:5,error:"length error, length: ".concat(n),loc:[1,2]};if(s.length<6+n+2)return{code:6,error:"Message is not complete",loc:[s.length-1]};var l=s[7+n]|s[8+n]<<8;return he(s.subarray(0,7+n))!==l?{code:7,error:"crc16 error, calc: 0x".concat(he(s.subarray(0,7+n)).toString(16),", msg: 0x").concat(l.toString(16)),loc:[7+n,8+n],header:{length:n,seq:i,cmd_id:r}}:{code:0,msg:s.subarray(7+n+2),header:{length:n,seq:i,cmd_id:r}}}var za=function(s){H()(n,s);var e=P()(n);function n(){var i;I()(this,n);for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return i=e.call.apply(e,[this].concat(r)),b()(w()(i),"state",{show:!1,history:{rx:0,log:[],start:-1}}),i}return A()(n,[{key:"onClose",value:function(){this.setState({show:!1})}},{key:"show",value:function(t){this.setState({show:!0,history:B()(B()({},t),{},{start:-1})})}},{key:"save",value:function(){var t="",r=O()(this.state.history.log),a;try{for(r.s();!(a=r.n()).done;){var l=a.value,o=O()(l),c;try{for(o.s();!(c=o.n()).done;){var h=c.value;t+=h.toString(16).padStart(2,"0").toUpperCase()+" "}}catch(v){o.e(v)}finally{o.f()}t=t.slice(0,-1)+`
`}}catch(v){r.e(v)}finally{r.f()}t=t.slice(0,-1),Ae(t,"rx.log")}},{key:"load",value:function(){var i=k()(x()().mark(function r(){var a=this,l,o;return x()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,Ee(".log");case 2:l=h.sent,o=new FileReader,o.onload=function(){var v=o.result,p=v.split(`
`),d=0,g=[],y=O()(p),M;try{for(y.s();!(M=y.n()).done;){var j=M.value,S=[],L=j.split(" "),F=O()(L),Q;try{for(F.s();!(Q=F.n()).done;){var f=Q.value;S.push(parseInt(f,16))}}catch(R){F.e(R)}finally{F.f()}g.push(new Uint8Array(S)),d+=S.length}}catch(R){y.e(R)}finally{y.f()}a.setState({history:{rx:d,log:g,start:-1}})},o.readAsText(l);case 6:case"end":return h.stop()}},r)}));function t(){return i.apply(this,arguments)}return t}()},{key:"render",value:function(){var t=this,r=this,a=this.state.history,l;if(a.log.length===0)l=(0,u.jsx)(pe.Z,{image:pe.Z.PRESENTED_IMAGE_SIMPLE,description:"No log yet."});else{l=[];for(var o=0,c=function(d,g){return d==="A5"?(0,u.jsx)(We.Z,{color:"blue",onClick:function(){return r.setState({history:B()(B()({},r.state.history),{},{start:g})})},children:d},g):(0,u.jsx)(We.Z,{children:d},g)},h=function(d){var g=a.log[d];if(o>a.start||o+g.length<a.start)l.push((0,u.jsx)(oe.Z,{},d)),l.push(Array.from(g).map(function(Z){return Z.toString(16).padStart(2,"0").toUpperCase()}).map(function(Z){var D=c(Z,o);return o+=1,D}));else{l.push((0,u.jsx)(oe.Z,{},"".concat(d,"-prefix")));var y=a.start-o,M=Array.from(g.slice(0,y));l.push(Array.from(M).map(function(Z){return Z.toString(16).padStart(2,"0").toUpperCase()}).map(function(Z){var D=c(Z,o);return o+=1,D})),l.push((0,u.jsx)(oe.Z,{},"".concat(d,"-msg")));for(var j=E()(g.slice(y)),S=[0],L=d+1;L<a.log.length;L++)S.push(j.length),j.push.apply(j,E()(Array.from(a.log[L])));var F=function(D){l.push((0,u.jsx)(oe.Z,{},"".concat(d,"-suffix")));var T;for(T=0;T<S.length;T++)if(T===0){if(a.log[T+d].length-y>D){var K=a.log[T+d];l.push(Array.from(K.slice(D+y)).map(function($){return $.toString(16).padStart(2,"0").toUpperCase()}).map(function($){var re=c($,o);return o+=1,re}));break}}else if(S[T]+a.log[T+d].length>D){var ee=a.log[T+d];l.push(Array.from(ee.slice(D-S[T])).map(function($){return $.toString(16).padStart(2,"0").toUpperCase()}).map(function($){var re=c($,o);return o+=1,re}));break}d+=T},Q=function(D,T,K,ee){return(0,u.jsx)(Ma.Z,{title:ee,content:(0,u.jsx)(tt.vY,{dataSource:K,columns:ot(K),editable:!1,column:1,style:{width:250}},"".concat(o,"-").concat(ee)),destroyTooltipOnHide:!0,children:T!=="Object"?Array.from(D).map(function($){return $.toString(16).padStart(2,"0").toUpperCase()}).map(function($){var re=ze($,o,T);return o+=1,re}):D})},f=function(D){var T=Ct(Uint8Array.from(D));if(T.events.length>0){var K=[Q(D.slice(0,6),"purple",T,"Info")],ee="geekblue",$=O()(T.events),re;try{for($.s();!(re=$.n()).done;){var Ce=re.value;K.push(Q(D.slice(Ce.obj._start,Ce.obj._end),ee,B()({operation:Ce.type},Ce.obj),"Object")),ee==="geekblue"?ee="cyan":ee="geekblue"}}catch(ve){$.e(ve)}finally{$.f()}return K}else{var Ut=[Q(D.slice(0,2),"geekblue",{error:"Wrong sub cmd id",sub_id:T.sub_id},"Error")];return Ut.push(Array.from(D.slice(2)).map(function(ve){return ve.toString(16).padStart(2,"0").toUpperCase()}).map(function(ve){var ki=ze(ve,o,"orange");return o+=1,ki})),Ut}},R=ja(Uint8Array.from(j));console.log(R);var ze=function(D,T,K){return(0,u.jsx)(We.Z,{color:K,children:D},T)};if(R.code===0){var Rt,fe=R.header;l.push(Q(j.slice(0,7),"green",fe,"Header")),(Rt=l).push.apply(Rt,E()(f(j.slice(7,fe.length+7)))),l.push(Array.from(j.slice(fe.length+7,fe.length+9)).map(function(Z){return Z.toString(16).padStart(2,"0").toUpperCase()}).map(function(Z){var D=ze(Z,o,"green");return o+=1,D})),F(fe.length+9)}else if(R.code<=2)l.push(Q(j.slice(0,1),"red",R,"Error")),F(1);else if(R.code<=6)l.push(Q(Array.from(j.slice(0,5)).map(function(Z){return Z.toString(16).padStart(2,"0").toUpperCase()}).map(function(Z,D){var T="green";R.loc.includes(D)&&(T="red");var K=ze(Z,o,T);return o+=1,K}),"Object",R,"Error")),F(5);else if(R.code<=7){var Lt;l.push(Q(j.slice(0,7),"green",R.header,"Header")),(Lt=l).push.apply(Lt,E()(f(j.slice(7,R.loc[0])))),l.push(Q(j.slice(R.loc[0],R.loc[1]+1),"red",R,"Error")),F(R.loc[1]+1)}}v=d},v=0;v<a.log.length;v++)h(v)}return(0,u.jsx)(ke.Z,{title:"Serial Rx History",placement:"right",onClose:function(){return t.onClose()},open:this.state.show,size:"large",getContainer:document.getElementById("content-in"),rootStyle:{inset:"25px 0 0 0"},style:{borderTop:"3px var(--ant-line-type) var(--ant-color-split)"},children:(0,u.jsx)("div",{style:{width:"100%",height:"calc(100% - 25px)"},children:(0,u.jsxs)("div",{style:{color:"var(--ant-color-text)",height:"100%"},children:[(0,u.jsxs)(me.Z,{justify:"space-between",align:"center",children:[(0,u.jsxs)("p",{style:{margin:6},children:["RX: ",a.rx,",\xA0\xA0 This is not a real-time display, close and reopen to refresh."]}),(0,u.jsxs)(G.Z,{children:[(0,u.jsx)(C.ZP,{size:"small",type:"primary",onClick:function(){return t.save()},children:"Save"}),(0,u.jsx)(C.ZP,{size:"small",onClick:function(){return t.load()},children:"load"})]})]}),(0,u.jsx)("div",{style:{paddingBottom:10},className:"card-body",children:l})]})})})}}]),n}(z.Component),Ca=za,Ia=m(18299),Aa=function(s){H()(n,s);var e=P()(n);function n(){return I()(this,n),e.apply(this,arguments)}return A()(n,[{key:"render",value:function(){return(0,u.jsxs)(me.Z,{style:{width:"100%"},justify:"space-between",children:[this.props.children,(0,u.jsx)("div",{children:this.props.checked&&(0,u.jsx)(Ia.Z,{})})]})}}]),n}(z.Component),Ta=Aa,de=m(73344),Da=function(s){H()(n,s);var e=P()(n);function n(){return I()(this,n),e.apply(this,arguments)}return A()(n,[{key:"render",value:function(){var t=this.props.errors.filter(function(l){return l.level==="Warn"}),r=this.props.errors.filter(function(l){return l.level==="Error"}),a=(0,u.jsx)(be.ZP,{status:"success",title:"Check Passed!",subTitle:"0 error, 0 warning!",style:{marginTop:"50px"}});return r.length+t.length>0&&(a=(0,u.jsxs)("div",{style:{color:"var(--ant-color-text)",height:"100%"},children:[(0,u.jsxs)("p",{children:["Found ",r.length," errors, ",t.length," warnings."]}),(0,u.jsx)("div",{style:{paddingBottom:10},className:"card-body",children:(0,u.jsx)(we.Z,{bordered:!0,dataSource:this.props.errors,renderItem:function(o){return(0,u.jsx)(we.Z.Item,{children:(0,u.jsxs)(G.Z,{size:"middle",children:[o.level==="warning"?(0,u.jsx)(kt.Z,{}):(0,u.jsx)(St.Z,{}),o.message]})})}})})]})),(0,u.jsxs)("div",{style:{width:"100%",height:"calc(100% - 50px)"},children:[(0,u.jsx)("h3",{style:{color:"var(--ant-color-text)"},children:"Check Data"}),a]})}}]),n}(z.Component),Oa=Da,Ea=m(69615),Na=m(42308),It=m(24389),Fa=m(51376);function Ra(s){var e="";return s.h&&(e+=".h"),s.h&&s.c&&(e+=" and "),s.c&&(e+=".c"),e}function La(){var s=document.querySelector(".rmui"),e=getComputedStyle(s),n=e.getPropertyValue("--ant-color-text-base");return n==="#fff"}var Ua=function(s){H()(n,s);var e=P()(n);function n(){var i;I()(this,n);for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return i=e.call.apply(e,[this].concat(r)),b()(w()(i),"state",{preview:null,fileName:""}),b()(w()(i),"checked",[]),i}return A()(n,[{key:"review",value:function(t,r){this.setState({preview:this.props.code[t][r],fileName:"".concat(t,".").concat(r)})}},{key:"download",value:function(t,r){Ae(this.props.code[t][r],"".concat(t,".").concat(r)),console.log(this.props.code[t][r])}},{key:"downloadChecked",value:function(){var i=k()(x()().mark(function r(){var a,l,o,c,h;return x()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(this.checked.length!==0){p.next=3;break}return W.error("Please select at least one file."),p.abrupt("return");case 3:return a={},p.t0=B(),p.t1=B()({},this.props.code),p.next=8,this.props.getUiBase();case 8:p.t2=p.sent,l=(0,p.t0)(p.t1,p.t2),o=O()(this.checked);try{for(o.s();!(c=o.n()).done;)h=c.value,a[h]=l[h]}catch(d){o.e(d)}finally{o.f()}st(a).then(function(d){it(d,"codes.zip")});case 13:case"end":return p.stop()}},r,this)}));function t(){return i.apply(this,arguments)}return t}()},{key:"render",value:function(){var t=this,r=[{file:"ui base .h and .c",key:"_base"}];for(var a in this.props.code)r.push({file:"".concat(a," ").concat(Ra(this.props.code[a])),key:a,h:this.props.code[a].h!==void 0,c:this.props.code[a].c!==void 0});return(0,u.jsxs)("div",{className:"full",style:{overflow:"hidden"},children:[(0,u.jsx)("h3",{style:{color:"var(--ant-color-text)",marginBottom:20},children:"Download Data"}),(0,u.jsx)("div",{style:{paddingBottom:36},className:"card-body",children:(0,u.jsx)(Ea.Z,{columns:[{title:"File",dataIndex:"file",key:"file"},{title:"Preview",dataIndex:"key",key:"preview",render:function(o,c){return(0,u.jsxs)(G.Z,{children:[c.h&&(0,u.jsx)(C.ZP,{type:"link",onClick:function(){t.review(o,"h")},children:"Preview .h"}),c.c&&(0,u.jsx)(C.ZP,{type:"link",onClick:function(){t.review(o,"c")},children:"Preview .c"})]})}},{title:"Download",dataIndex:"key",key:"download",render:function(o,c){return o!=="_base"?(0,u.jsxs)(G.Z,{children:[c.h&&(0,u.jsx)(C.ZP,{type:"link",onClick:function(){t.download(o,"h")},children:"Download .h"}),c.c&&(0,u.jsx)(C.ZP,{type:"link",onClick:function(){t.download(o,"c")},children:"Download .c"})]}):(0,u.jsx)(C.ZP,{type:"link",onClick:k()(x()().mark(function h(){var v,p;return x()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,t.props.getUiBase();case 2:return v=g.sent,g.next=5,st(v);case 5:p=g.sent,it(p,"ui_base.zip");case 7:case"end":return g.stop()}},h)})),children:"Download .zip"})}}],dataSource:r,rowSelection:{type:"checkbox",onChange:function(o){var c=E()(o);c.includes("_base")&&(c=c.filter(function(h){return h!=="_base"}),c.push("ui_types"),c.push("ui_interface")),t.checked=c},getCheckboxProps:function(o){return{name:o.key}}},pagination:!1})}),(0,u.jsx)(ke.Z,{onClose:function(){return t.setState({preview:null})},open:this.state.preview!==null,title:this.state.fileName,size:"large",getContainer:document.getElementById("content-in"),rootStyle:{inset:"25px 0 0 0"},children:(0,u.jsx)("div",{style:{height:"100%",overflow:"auto"},children:(0,u.jsx)(Na.ZP,{value:this.state.preview||"",theme:La()?It.ub:It.tR,extensions:[(0,Fa.N)()],onContextMenu:function(o){o.stopPropagation()}})})})]})}}]),n}(z.Component),Za=Ua;function Ha(s){var e=new Uint8Array(15),n=0,i=s.group.split("-");e[n++]=Math.round(Number(i[0])),e[n++]=Math.round(Number(i[1])),e[n++]=Math.round(s.id);var t=Math.round(s.operate_tpyel)|Math.round(s.figure_tpye)<<3|Math.round(s.layer)<<6|Math.round(s.color)<<10|Math.round(s._a)<<14|Math.round(s._b)<<23;e[n++]=t&255,e[n++]=t>>8&255,e[n++]=t>>16&255,e[n++]=t>>24&255;var r=Math.round(s.width)|Math.round(s.start_x)<<10|Math.round(s.start_y)<<21;e[n++]=r&255,e[n++]=r>>8&255,e[n++]=r>>16&255,e[n++]=r>>24&255;var a=Math.round(s._c)|Math.round(s._d)<<10|Math.round(s._e)<<21;return e[n++]=a&255,e[n++]=a>>8&255,e[n++]=a>>16&255,e[n++]=a>>24&255,e}function Pa(s){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"add",n=s.group,i=s.id&255,t=le.indexOf(s.type),r=Ye.indexOf(s.color),a=s.layer,l;s.fontSize?l=Math.round(s.fontSize/10):l=s.lineWidth;var o=s.x,c=s.y,h=0,v=0,p=0,d=0,g=0;switch(s.type.slice(2)){case"Line":d=s.x2||0,g=s.y2||0;break;case"Rect":d=(s.width||0)+o,g=(s.height||0)+c;break;case"Round":p=s.r||0;break;case"Ellipse":d=s.rx||0,g=s.ry||0;break;case"Arc":h=s.startAngle||0,v=s.endAngle||0,d=s.rx||0,g=s.ry||0;break;case"Float":h=s.fontSize||0;var y=(s.float||0)*1e3;p=y&1023,d=y>>10&2047,g=y>>21&2047;break;case"Number":h=s.fontSize||0;var M=s.number||0;p=M&1023,d=M>>10&2047,g=M>>21&2047;break;case"Text":h=s.fontSize||0,v=(s.text||"").length;break}return{group:n,id:i,operate_tpyel:$e.indexOf(e),figure_tpye:t,layer:a,color:r,_a:h,_b:v,width:l,start_x:o,start_y:c,_c:p,_d:d,_e:g,number:p}}function At(s){return Ha(Pa(s))}function Ba(s){var e=new Uint8Array(0);if(s.forEach(function(a){e=new Uint8Array([].concat(E()(e),E()(At(a))))}),2<s.length&&s.length<5){for(var n=new Uint8Array(15*(5-s.length)),i=0;i<15*(5-s.length);i++)n[i]=0;e=new Uint8Array([].concat(E()(e),E()(n)))}if(5<s.length&&s.length<7){for(var t=new Uint8Array(15*(7-s.length)),r=0;r<15*(7-s.length);r++)t[r]=0;e=new Uint8Array([].concat(E()(e),E()(t)))}return e}function Wa(s){var e=new Uint8Array([].concat(E()(At(s[0])),E()(new Uint8Array(30))));if(s[0].text)for(var n=15;n<s[0].text.length+15;n++)e[n]=s[0].text.charCodeAt(n);return e}function Ya(s){return s[0].text?Wa(s):Ba(s)}var Se=0,Tt=769;function Dt(s){var e=new Uint8Array(13),n=new Uint8Array(2);e[0]=165;var i=s.length+6;e[1]=i&255,e[2]=i>>8&255,e[3]=Se,e[4]=ce(e.subarray(0,4)),e[5]=Tt&255,e[6]=Tt>>8&255;var t=0;s.length===2?t=256:s.length===15?t=257:s.length===30?t=258:s.length===75?t=259:s.length===105?t=260:s.length===45&&(t=272),e[7]=t&255,e[8]=t>>8&255,e[9]=q&255,e[10]=q>>8&255,e[11]=q+256&255,e[12]=q+256>>8&255;var r=new Uint8Array([].concat(E()(e),E()(s),E()(n))),a=he(r.subarray(0,r.length-2));return r[r.length-2]=a&255,r[r.length-1]=a>>8&255,Se++,Se>=256&&(Se=0),r}function $a(s){var e=Ya(s);return Dt(e)}function Ga(){return Dt(new Uint8Array([2,0]))}var Qa=function(){function s(e,n,i){I()(this,s),this.frame_name=e,this.split_id=n,this.objs=i}return A()(s,[{key:"toSerialMsg",value:function(){var n=[],i=O()(this.objs),t;try{for(i.s();!(t=i.n()).done;){var r=t.value,a=B()({},r);a.group="".concat(this.frame_name,"-").concat(this.split_id),n.push(a)}}catch(l){i.e(l)}finally{i.f()}return $a(n)}}]),s}(),Ot=Qa,Va=function(){function s(e,n,i){I()(this,s),this.frame_name=e,this.group_name=n,this.splits=[];var t=O()(i),r;try{for(t.s();!(r=t.n()).done;){var a=r.value;a.type==="UiText"&&this.splits.push(new Ot(this.frame_name,this.splits.length,[a]))}}catch(h){t.e(h)}finally{t.f()}for(var l=i.filter(function(h){return h.type!=="UiText"}),o=Math.ceil(l.length/7),c=0;c<o;c++)this.splits.push(new Ot(this.frame_name,this.splits.length,l.slice(c*7,(c+1)*7)))}return A()(s,[{key:"toSerialMsg",value:function(){var n=[],i=O()(this.splits),t;try{for(i.s();!(t=i.n()).done;){var r=t.value;n.push(r.toSerialMsg())}}catch(a){i.e(a)}finally{i.f()}return n}}]),s}(),Ja=Va,Ka=function(){function s(e,n){I()(this,s),this.name=e,this.groups=[];var i={};for(var t in n){var r=n[t];r.group in i?i[r.group].push(r):i[r.group]=[r]}for(var a in i)this.groups.push(new Ja(this.name,a,i[a]))}return A()(s,[{key:"toSerialMsg",value:function(){var n=[],i=O()(this.groups),t;try{for(i.s();!(t=i.n()).done;){var r=t.value;n=n.concat(r.toSerialMsg())}}catch(a){i.e(a)}finally{i.f()}return n}}]),s}(),Et=Ka,Xa=m(35394),qa=m(84378),_a=m(49200),ei=m(76631),ti=m(40539),ri=m(12285);function ai(s){return Ve.apply(this,arguments)}function Ve(){return Ve=k()(x()().mark(function s(e){return x()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!e){i.next=21;break}return i.next=3,fetch(Xa);case 3:return i.next=5,i.sent.text();case 5:return i.t0=i.sent,i.next=8,fetch(qa);case 8:return i.next=10,i.sent.text();case 10:return i.t1=i.sent,i.t2={h:i.t0,c:i.t1},i.next=14,fetch(_a);case 14:return i.next=16,i.sent.text();case 16:return i.t3=i.sent,i.t4={h:i.t3},i.abrupt("return",{ui_interface:i.t2,ui_types:i.t4});case 21:return i.next=23,fetch(ei);case 23:return i.next=25,i.sent.text();case 25:return i.t5=i.sent,i.next=28,fetch(ti);case 28:return i.next=30,i.sent.text();case 30:return i.t6=i.sent,i.t7={h:i.t5,c:i.t6},i.next=34,fetch(ri);case 34:return i.next=36,i.sent.text();case 36:return i.t8=i.sent,i.t9={h:i.t8},i.abrupt("return",{ui_interface:i.t7,ui_types:i.t9});case 39:case"end":return i.stop()}},s)})),Ve.apply(this,arguments)}var ii=function(){function s(e,n){if(I()(this,s),this.res=JSON.parse(window.Module.generate(JSON.stringify(e),n)),this.frames=[],Object.keys(e).length===1)this.frames.push(new Et("g",e[Object.keys(e)[0]]));else for(var i in e)this.frames.push(new Et(i,e[i]))}return A()(s,[{key:"gen",value:function(){return this.res.code}},{key:"getUiBase",value:function(n){return function(){return ai(n)}}},{key:"check",value:function(){return this.res.info}},{key:"toSerialMsg",value:function(){var n={},i=O()(this.frames),t;try{for(i.s();!(t=i.n()).done;){var r=t.value;n[r.name]=r.toSerialMsg()}}catch(a){i.e(a)}finally{i.f()}return n}}]),s}(),Nt=ii,si=function(s){H()(n,s);var e=P()(n);function n(){var i;I()(this,n);for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return i=e.call.apply(e,[this].concat(r)),b()(w()(i),"state",{show:!1,step:"check"}),b()(w()(i),"downloadRef",(0,z.createRef)()),b()(w()(i),"data",{}),b()(w()(i),"errors",[]),i}return A()(n,[{key:"gen",value:function(t,r){this.helper=new Nt(t,r!=="dynamic"),this.data=t,this.code=this.helper.gen(),this.errors=this.helper.check(),this.setState({show:!0,step:"check"})}},{key:"onClose",value:function(){this.setState({show:!1})}},{key:"render",value:function(){var t=this,r=(0,u.jsx)(C.ZP,{type:"primary",onClick:function(){return t.setState({step:"generate"})},disabled:this.errors.filter(function(l){return l.level==="error"}).length>0,children:"Generate"}),a=(0,u.jsx)(C.ZP,{type:"primary",onClick:function(){var o;return(o=t.downloadRef)===null||o===void 0||(o=o.current)===null||o===void 0?void 0:o.downloadChecked()},children:"Download"});return(0,u.jsx)("div",{children:(0,u.jsx)(ke.Z,{title:"C Code Generator",placement:"right",onClose:function(){return t.onClose()},open:this.state.show,size:"large",getContainer:document.getElementById("content-in"),rootStyle:{inset:"25px 0 0 0"},style:{borderTop:"3px var(--ant-line-type) var(--ant-color-split)"},footer:(0,u.jsx)("div",{style:{width:"100%",display:"flex",justifyContent:"flex-end",padding:5},children:this.state.step==="check"?r:a}),children:this.state.step==="check"?(0,u.jsx)(Oa,{errors:this.errors}):(0,u.jsx)(Za,{code:this.code,getUiBase:this.helper.getUiBase(),ref:this.downloadRef})})})}}]),n}(z.Component),ni=si,li=function(){function s(){I()(this,s),b()(this,"messages",[]),b()(this,"enabled",!1),b()(this,"log",[]),b()(this,"rx",0)}return A()(s,[{key:"warn",value:function(n){this.enabled&&(this.messages.push({level:"warn",message:n,time:new Date}),console.warn(n)),this.messages.length>100&&(this.messages=this.messages.slice(-100))}},{key:"error",value:function(n){this.enabled&&(this.messages.push({level:"error",message:n,time:new Date}),console.error(n)),this.messages.length>100&&(this.messages=this.messages.slice(-100))}},{key:"clear",value:function(){this.messages=[]}},{key:"logHistory",value:function(n){this.log.push(Uint8Array.from(E()(n))),this.rx+=n.length,this.log.length>100&&this.log.shift()}},{key:"get",value:function(){return this.messages}},{key:"getHistory",value:function(){return{log:E()(this.log),rx:this.rx}}}]),s}(),oi=new li,Y=oi,ui=[8,21,36,81,111,51],ci=function(){function s(){I()(this,s),b()(this,"buffer",void 0),this.buffer=new Uint8Array(0)}return A()(s,[{key:"transform",value:function(n,i){for(this.buffer=Uint8Array.from([].concat(E()(this.buffer),E()(n))),Y.logHistory(n);this.buffer.length>7;){if(this.buffer[0]!==165){this.buffer=this.buffer.subarray(1);continue}if(this.buffer.length<7)break;var t=this.buffer[1]|this.buffer[2]<<8,r=this.buffer[3],a=this.buffer[4],l=this.buffer[5]|this.buffer[6]<<8,o=this.buffer.subarray(0,4);if(ce(o)!==a){this.buffer=this.buffer.subarray(1),Y.warn("crc8 error, calc: 0x".concat(ce(o).toString(16),", msg: 0x").concat(a.toString(16)));continue}if(l!==769){this.buffer=this.buffer.subarray(1),Y.warn("cmd_id 0x".concat(l.toString(16)," not match"));continue}if(!ui.includes(t)){this.buffer=this.buffer.subarray(1),Y.warn("length error, length: ".concat(t));continue}if(this.buffer.length<6+t+2)break;var c=this.buffer.subarray(7,7+t),h=this.buffer[7+t]|this.buffer[8+t]<<8;if(he(this.buffer.subarray(0,7+t))!==h){this.buffer=this.buffer.subarray(1),Y.error("crc16 error, calc: 0x".concat(he(this.buffer.subarray(0,7+t)).toString(16),", msg: 0x").concat(h.toString(16)));continue}i.enqueue(c),this.buffer=this.buffer.subarray(7+t+2)}}}]),s}(),Je=ci,hi=function(){function s(e,n){I()(this,s),b()(this,"options",{baudRate:115200,dataBits:8,stopBits:1,flowControl:"none",parity:"none"}),this.onEvent=e,this.onError=n,this.reader=null,this.transformer=new TransformStream(new Je)}return A()(s,[{key:"connect",value:function(){var e=k()(x()().mark(function i(){return x()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if("serial"in navigator){r.next=3;break}return W.error("Web Serial API not supported."),r.abrupt("return");case 3:return r.next=5,navigator.serial.requestPort();case 5:return this.port=r.sent,r.next=8,this.port.open(this.options);case 8:this.readableStreamClosed=this.port.readable.pipeTo(this.transformer.writable),this.reader=this.transformer.readable.getReader(),Y.enabled=!0,Y.clear(),this.readLoop();case 13:case"end":return r.stop()}},i,this)}));function n(){return e.apply(this,arguments)}return n}()},{key:"stop",value:function(){var e=k()(x()().mark(function i(){var t,r,a;return x()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return t=new TextEncoderStream,r=t.writable.getWriter(),a=t.readable.pipeTo(this.port.writable),this.reader.cancel(),o.next=6,this.readableStreamClosed.catch(function(){});case 6:return r.close(),o.next=9,a;case 9:return o.next=11,this.port.close();case 11:this.reader=null,this.transformer=new TransformStream(new Je),Y.enabled=!1;case 14:case"end":return o.stop()}},i,this)}));function n(){return e.apply(this,arguments)}return n}()},{key:"readLoop",value:function(){var e=k()(x()().mark(function i(){var t,r,a,l,o,c,h,v;return x()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:d.prev=0;case 1:return d.next=4,this.reader.read();case 4:if(t=d.sent,r=t.value,a=t.done,!a){d.next=10;break}return this.reader.releaseLock(),d.abrupt("break",21);case 10:if(l=Ct(r),l.sender===q){d.next=14;break}return Y.error("Sender ".concat(l.sender," not match self ").concat(q)),d.abrupt("continue",1);case 14:if(l.receiver===q+256){d.next=17;break}return Y.error("Receiver ".concat(l.receiver," not match self ").concat(q)),d.abrupt("continue",1);case 17:if(o=this===null||this===void 0?void 0:this.onEvent(l),o){c=O()(o);try{for(c.s();!(h=c.n()).done;)v=h.value,v[0]==="W"?Y.warn(v.slice(3)):v[0]==="E"&&Y.error(v.slice(3))}catch(g){c.e(g)}finally{c.f()}}d.next=1;break;case 21:d.next=37;break;case 23:return d.prev=23,d.t0=d.catch(0),d.prev=25,d.next=28,this.stop();case 28:d.next=32;break;case 30:d.prev=30,d.t1=d.catch(25);case 32:this.reader=null,this.transformer=new TransformStream(new Je),Y.enabled=!1,Y.clear(),this.onError(d.t0);case 37:case"end":return d.stop()}},i,this,[[0,23],[25,30]])}));function n(){return e.apply(this,arguments)}return n}()},{key:"getLog",value:function(){return Y.get()}},{key:"getHistory",value:function(){return Y.getHistory()}}]),s}(),di=hi,fi=function(){function s(){I()(this,s),b()(this,"options",{baudRate:115200,dataBits:8,stopBits:1,flowControl:"none",parity:"none"}),b()(this,"writer",null)}return A()(s,[{key:"connect",value:function(){var e=k()(x()().mark(function i(){return x()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if("serial"in navigator){r.next=3;break}return W.error("Web Serial API not supported."),r.abrupt("return");case 3:return r.next=5,navigator.serial.requestPort();case 5:return this.port=r.sent,r.next=8,this.port.open(this.options);case 8:this.writer=this.port.writable.getWriter();case 9:case"end":return r.stop()}},i,this)}));function n(){return e.apply(this,arguments)}return n}()},{key:"stop",value:function(){var e=k()(x()().mark(function i(){return x()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.writer.releaseLock();case 2:return this.writer=null,r.next=5,this.port.close();case 5:case"end":return r.stop()}},i,this)}));function n(){return e.apply(this,arguments)}return n}()},{key:"write",value:function(){var e=k()(x()().mark(function i(t){var r=this,a,l,o,c,h,v,p;return x()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(this.writer){g.next=3;break}return W.error("Serial port is not open."),g.abrupt("return");case 3:a=0,setTimeout(function(){r.writer.write(Ga())},a),a+=50,l=new Nt(t.data),o=l.toSerialMsg(),c=o[t.selected],h=O()(c),g.prev=10,p=x()().mark(function y(){var M;return x()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:M=v.value,setTimeout(function(){r.writer.write(M)},a),a+=50;case 3:case"end":return S.stop()}},y)}),h.s();case 13:if((v=h.n()).done){g.next=17;break}return g.delegateYield(p(),"t0",15);case 15:g.next=13;break;case 17:g.next=22;break;case 19:g.prev=19,g.t1=g.catch(10),h.e(g.t1);case 22:return g.prev=22,h.f(),g.finish(22);case 25:case"end":return g.stop()}},i,this,[[10,19,22,25]])}));function n(i){return e.apply(this,arguments)}return n}()}]),s}(),vi=fi,je=[{key:"File-new",label:"New"},{key:"File-open",label:"Open"},{key:"File-save",label:"Save"},{key:"File-saveAs",label:"Save as"},{key:"File-autoSave",label:"Auto Save"},{type:"divider"},{key:"File-generate1",label:"Generate Static Code",icon:(0,u.jsx)(pt.Z,{})},{key:"File-generate2",label:"Generate Dynamic Code",icon:(0,u.jsx)(pt.Z,{})}],Ke=[{key:"Edit-undo",label:"Undo"},{key:"Edit-redo",label:"Redo"},{key:"Edit-reset",label:"Reset History"}],_=[{key:"Simulate-from",label:"From Robot",children:[{key:"Simulate-from-start",label:"Start"},{key:"Simulate-from-stop",label:"Stop"},{key:"Simulate-from-log",label:"Debug Log"},{key:"Simulate-from-rx",label:"Rx History"}]},{key:"Simulate-to",label:"To Referee",children:[{key:"Simulate-to-start",label:"Start"},{key:"Simulate-to-stop",label:"Stop"},{key:"Simulate-to-update",label:"Update"}]},{key:"Simulate-settings",label:"Settings"}],pi=function(s){H()(n,s);var e=P()(n);function n(){var i;I()(this,n);for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return i=e.call.apply(e,[this].concat(r)),b()(w()(i),"state",{fullscreen:!1,frames:["default"],selectedFrame:"default",darkMode:!1,couldUndo:!1,couldRedo:!1,serialStart:!1,serialToStart:!1,autoSave:!0}),b()(w()(i),"formRef",(0,z.createRef)()),b()(w()(i),"aboutRef",(0,z.createRef)()),b()(w()(i),"generatorRef",(0,z.createRef)()),b()(w()(i),"logDrawerRef",(0,z.createRef)()),b()(w()(i),"rxDrawerRef",(0,z.createRef)()),b()(w()(i),"serialModalRef",(0,z.createRef)()),b()(w()(i),"modeModalRef",(0,z.createRef)()),b()(w()(i),"tauri",V()),b()(w()(i),"serial",new di(function(l){return i.onSerialEvent(l)},function(l){return i.onSerialError(l)})),b()(w()(i),"serialTo",new vi),b()(w()(i),"fileHandler",null),i}return A()(n,[{key:"onSerialEvent",value:function(t){var r=[],a=O()(t.events),l;try{for(a.s();!(l=a.n()).done;){var o=l.value,c=this.props.onObjectEvent(o.type,o.obj);(c[0]==="W"||c[0]==="E")&&r.push(c)}}catch(h){a.e(h)}finally{a.f()}return r}},{key:"onSerialError",value:function(t){this.props.setEditable(!0),this.setState({serialStart:!1}),W.error(t.text)}},{key:"componentDidMount",value:function(){var i=k()(x()().mark(function r(){var a=this,l,o,c,h,v;return x()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(c=function(){return c=k()(x()().mark(function y(){var M;return x()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,de.G.isMaximized();case 2:M=S.sent,l.setState({fullscreen:M});case 4:case"end":return S.stop()}},y)})),c.apply(this,arguments)},o=function(){return c.apply(this,arguments)},l=this,!this.tauri){d.next=8;break}return d.next=6,o();case 6:return d.next=8,de.G.onResized(function(g){return o()});case 8:return d.next=11,(h=this.modeModalRef.current)===null||h===void 0?void 0:h.open();case 11:if(v=d.sent,v!=="new"){d.next=25;break}return this.fileHandler=new yt(function(){return JSON.stringify({version:2,data:a.props.getData(),selected:a.state.selectedFrame})}),d.next=16,this.fileHandler.create();case 16:if(!d.sent){d.next=23;break}return d.t0=this.props,d.next=20,this.fileHandler.read();case 20:return d.t1=d.sent,d.t0.upload.call(d.t0,d.t1),d.abrupt("break",42);case 23:d.next=40;break;case 25:if(v!=="open"){d.next=38;break}return this.fileHandler=new yt(function(){return JSON.stringify({version:2,data:a.props.getData(),selected:a.state.selectedFrame})}),d.next=29,this.fileHandler.open();case 29:if(!d.sent){d.next=36;break}return d.t2=this.props,d.next=33,this.fileHandler.read();case 33:return d.t3=d.sent,d.t2.upload.call(d.t2,d.t3),d.abrupt("break",42);case 36:d.next=40;break;case 38:return this.setState({autoSave:!1}),d.abrupt("break",42);case 40:d.next=8;break;case 42:window.addEventListener("keydown",function(){var g=k()(x()().mark(function y(M){return x()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(!(M.ctrlKey&&M.key==="s")){S.next=8;break}if(M.preventDefault(),!a.fileHandler){S.next=7;break}return S.next=5,a.fileHandler.save();case 5:S.next=8;break;case 7:Te(a.props.getData(),"ui.rmui",a.state.selectedFrame);case 8:case"end":return S.stop()}},y)}));return function(y){return g.apply(this,arguments)}}());case 43:case"end":return d.stop()}},r,this)}));function t(){return i.apply(this,arguments)}return t}()},{key:"setCouldDo",value:function(t){this.setState({couldUndo:t.couldPrevious,couldRedo:t.couldNext}),this.fileHandler&&this.state.autoSave&&this.fileHandler.update()}},{key:"fullScreen",value:function(){if(this.tauri)de.G.maximize();else{var t=document.documentElement;t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()}this.setState({fullscreen:!0})}},{key:"exitFullscreen",value:function(){this.tauri?de.G.unmaximize():document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),this.setState({fullscreen:!1})}},{key:"setFrames",value:function(t){this.setState({frames:t.frames,selectedFrame:t.selected})}},{key:"onMenuClick",value:function(){var i=k()(x()().mark(function r(a){var l=this,o,c,h,v,p,d,g,y,M,j,S,L,F;return x()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(o=a.keyPath[a.keyPath.length-1],o.slice(0,6)!=="Insert"){f.next=7;break}c=a.key.slice(7),h={id:-1,name:"New".concat(c),layer:0,group:"Ungroup",type:"Ui".concat(c)},this.props.onObjectEvent("_add",h),f.next=207;break;case 7:if(o!=="Edit-reset"){f.next=11;break}this.props.onHistoryEvent("resetNow"),f.next=207;break;case 11:if(o!=="Edit-undo"){f.next=15;break}this.props.onHistoryEvent("previous"),f.next=207;break;case 15:if(o!=="Edit-redo"){f.next=19;break}this.props.onHistoryEvent("next"),f.next=207;break;case 19:if(o!=="File-new"){f.next=40;break}if(!this.fileHandler){f.next=36;break}return f.next=23,this.fileHandler.disableAutoSave();case 23:return this.setState({autoSave:!1}),f.next=26,this.fileHandler.create();case 26:if(!f.sent){f.next=34;break}return f.t0=this.props,f.next=30,this.fileHandler.read();case 30:f.t1=f.sent,f.t0.upload.call(f.t0,f.t1),this.fileHandler.enableAutoSave(),this.setState({autoSave:!0});case 34:f.next=38;break;case 36:this.props.reset(),this.props.onHistoryEvent("reset");case 38:f.next=207;break;case 40:if(o!=="File-save"){f.next=49;break}if(!this.fileHandler){f.next=46;break}return f.next=44,this.fileHandler.save();case 44:f.next=47;break;case 46:Te(this.props.getData(),"ui.rmui",this.state.selectedFrame);case 47:f.next=207;break;case 49:if(o!=="File-saveAs"){f.next=63;break}if(!this.fileHandler){f.next=61;break}return f.next=53,this.fileHandler.disableAutoSave();case 53:return this.setState({autoSave:!1}),f.next=56,this.fileHandler.create();case 56:if(!f.sent){f.next=61;break}return f.next=59,this.fileHandler.save();case 59:this.fileHandler.enableAutoSave(),this.setState({autoSave:!0});case 61:f.next=207;break;case 63:if(o!=="File-autoSave"){f.next=74;break}if(!this.fileHandler){f.next=72;break}if(!this.state.autoSave){f.next=70;break}return f.next=68,this.fileHandler.disableAutoSave();case 68:f.next=71;break;case 70:this.fileHandler.enableAutoSave();case 71:this.setState({autoSave:!this.state.autoSave});case 72:f.next=207;break;case 74:if(o!=="File-open"){f.next=94;break}if(!this.fileHandler){f.next=91;break}return f.next=78,this.fileHandler.disableAutoSave();case 78:return this.setState({autoSave:!1}),f.next=81,this.fileHandler.open();case 81:if(!f.sent){f.next=89;break}return f.t2=this.props,f.next=85,this.fileHandler.read();case 85:f.t3=f.sent,f.t2.upload.call(f.t2,f.t3),this.fileHandler.enableAutoSave(),this.setState({autoSave:!0});case 89:f.next=92;break;case 91:Ee(".rmui").then(function(R){l.props.upload(R)}).catch(function(){});case 92:f.next=207;break;case 94:if(o!=="File-generate1"){f.next=98;break}(v=this.generatorRef.current)===null||v===void 0||v.gen(this.props.getData(),"static"),f.next=207;break;case 98:if(o!=="File-generate2"){f.next=102;break}(p=this.generatorRef.current)===null||p===void 0||p.gen(this.props.getData(),"dynamic"),f.next=207;break;case 102:if(o!=="FrameOp-add"){f.next=109;break}return f.next=105,this.formRef.current.open("New Frame",this.state.frames);case 105:d=f.sent,this.props.setFrame("add",d),f.next=207;break;case 109:if(o!=="FrameOp-remove"){f.next=113;break}this.props.setFrame("remove",this.state.selectedFrame),f.next=207;break;case 113:if(o!=="FrameOp-copy"){f.next=120;break}return f.next=116,this.formRef.current.open("Copy Frame To",this.state.frames);case 116:g=f.sent,this.props.setFrame("copy",g),f.next=207;break;case 120:if(o!=="FrameOp-rename"){f.next=127;break}return f.next=123,this.formRef.current.open("Rename Frame To",this.state.frames);case 123:y=f.sent,this.props.setFrame("rename",y),f.next=207;break;case 127:if(o!=="FrameOp-change"){f.next=132;break}M=a.key.slice(7),this.props.setFrame("change",M),f.next=207;break;case 132:if(a.key!=="Simulate-from-start"){f.next=145;break}return f.prev=133,f.next=136,this.serial.connect();case 136:this.props.setEditable(!1),this.setState({serialStart:!0}),f.next=143;break;case 140:f.prev=140,f.t4=f.catch(133),W.error(f.t4.text);case 143:f.next=207;break;case 145:if(a.key!=="Simulate-from-stop"){f.next=158;break}return f.prev=146,f.next=149,this.serial.stop();case 149:this.props.setEditable(!0),this.setState({serialStart:!1}),f.next=156;break;case 153:f.prev=153,f.t5=f.catch(146),W.error(f.t5.text);case 156:f.next=207;break;case 158:if(a.key!=="Simulate-from-log"){f.next=162;break}(j=this.logDrawerRef.current)===null||j===void 0||j.show(this.serial.getLog()),f.next=207;break;case 162:if(a.key!=="Simulate-from-rx"){f.next=166;break}(S=this.rxDrawerRef.current)===null||S===void 0||S.show(this.serial.getHistory()),f.next=207;break;case 166:if(a.key!=="Simulate-to-start"){f.next=179;break}return f.prev=167,f.next=170,this.serialTo.connect();case 170:W.warning("This Module is beta now, maybe not work!"),this.setState({serialToStart:!0}),f.next=177;break;case 174:f.prev=174,f.t6=f.catch(167),W.error(f.t6.text);case 177:f.next=207;break;case 179:if(a.key!=="Simulate-to-stop"){f.next=191;break}return f.prev=180,f.next=183,this.serialTo.stop();case 183:this.setState({serialToStart:!1}),f.next=189;break;case 186:f.prev=186,f.t7=f.catch(180),W.error(f.t7.text);case 189:f.next=207;break;case 191:if(a.key!=="Simulate-to-update"){f.next=202;break}return f.prev=192,f.next=195,this.serialTo.write({data:this.props.getData(),selected:this.state.selectedFrame});case 195:f.next=200;break;case 197:f.prev=197,f.t8=f.catch(192),W.error(f.t8.text);case 200:f.next=207;break;case 202:if(o!=="Simulate-settings"){f.next=207;break}return f.next=205,(L=this.serialModalRef.current)===null||L===void 0?void 0:L.getOptions(this.serial.options);case 205:F=f.sent,F&&(this.serial.options=F);case 207:case"end":return f.stop()}},r,this,[[133,140],[146,153],[167,174],[180,186],[192,197]])}));function t(r){return i.apply(this,arguments)}return t}()},{key:"getFramesMenu",value:function(){var t=[{key:"FrameOp-add",label:"New Frame"},{key:"FrameOp-copy",label:"Copy This Frame"},{key:"FrameOp-rename",label:"Rename This Frame"},{key:"FrameOp-remove",label:"Remove This Frame"},{key:"FrameOp-change",label:"Change to",selectable:"true",children:[]}],r=O()(this.state.frames),a;try{for(r.s();!(a=r.n()).done;){var l=a.value;t[4].children.push({key:"Frames-".concat(l),label:l})}}catch(o){r.e(o)}finally{r.f()}return t}},{key:"render",value:function(){var t=this,r=(0,u.jsx)(C.ZP,{type:"text",onClick:function(){return t.fullScreen()},size:"small",children:(0,u.jsx)(Yr.Z,{style:{color:"var(--ant-color-text)"}})}),a=(0,u.jsx)(C.ZP,{type:"text",onClick:function(){return t.exitFullscreen()},size:"small",children:(0,u.jsx)($r.Z,{style:{color:"var(--ant-color-text)"}})}),l=(0,u.jsx)(C.ZP,{type:"text",onClick:function(){return t.props.setDarkMode(!0)},size:"small",children:(0,u.jsx)(mt.Z,{component:ca})}),o=(0,u.jsx)(C.ZP,{type:"text",onClick:function(){return t.props.setDarkMode(!1)},size:"small",children:(0,u.jsx)(mt.Z,{component:pa})});return Ke[0].disabled=!this.state.couldUndo,Ke[1].disabled=!this.state.couldRedo,_[0].disabled=this.state.serialToStart,_[1].disabled=this.state.serialStart,_[2].disabled=this.state.serialStart||this.state.serialToStart,_[0].children[0].disabled=this.state.serialStart,_[0].children[1].disabled=!this.state.serialStart,_[1].children[0].disabled=this.state.serialToStart,_[1].children[1].disabled=!this.state.serialToStart,_[1].children[2].disabled=!this.state.serialToStart,je[3].disabled=!this.fileHandler,je[4].disabled=!this.fileHandler,je[4].label=(0,u.jsx)(Ta,{checked:this.state.autoSave,children:"Auto Save"}),(0,u.jsxs)("div",{style:{width:"100%",height:32,marginTop:-5,zIndex:2e3,position:"relative"},className:"solid-color","data-tauri-drag-region":!0,children:[(0,u.jsxs)(me.Z,{style:{width:"100vw",display:"flex",paddingTop:-5},justify:"flex-start",align:"center","data-tauri-drag-region":!0,children:[(0,u.jsx)("div",{style:{fontFamily:"YouSheBiaoTiHei",fontSize:20,paddingLeft:6,paddingRight:6,paddingTop:3,display:"flex",color:"var(--ant-color-text)",cursor:"default"},"data-tauri-drag-region":!0,children:"RoboMaster UI Designer"}),(0,u.jsx)(ae.Z,{menu:{items:[].concat(je),onClick:function(h){return t.onMenuClick(h)}},children:(0,u.jsx)(C.ZP,{type:"text",size:"small",children:"File"})}),(0,u.jsx)(ae.Z,{menu:{items:[].concat(Ke),onClick:function(h){return t.onMenuClick(h)}},children:(0,u.jsx)(C.ZP,{type:"text",size:"small",children:"Edit"})}),(0,u.jsx)(ae.Z,{menu:{items:Sr(),onClick:function(h){return t.onMenuClick(h)}},children:(0,u.jsx)(C.ZP,{type:"text",size:"small",children:"Insert"})}),(0,u.jsx)(ae.Z,{menu:{items:this.getFramesMenu(),onClick:function(h){return t.onMenuClick(h)},selectedKeys:["Frames-".concat(this.state.selectedFrame)]},children:(0,u.jsx)(C.ZP,{type:"text",size:"small",children:"Frames"})}),(0,u.jsx)(ae.Z,{menu:{items:[].concat(_),onClick:function(h){return t.onMenuClick(h)}},children:(0,u.jsxs)(C.ZP,{type:"text",size:"small",children:["Simulate\xA0",(0,u.jsx)(Wr.Z,{color:this.state.serialStart||this.state.serialToStart?"green":"red"})]})}),(0,u.jsx)(C.ZP,{type:"text",size:"small",onClick:function(){var h;(h=t.aboutRef.current)===null||h===void 0||h.show()},children:"About"}),(0,u.jsxs)("div",{style:{marginRight:5,justifyContent:"flex-end",marginLeft:"auto",marginTop:2},"data-tauri-drag-region":!0,children:[!1,(0,u.jsxs)("div",{style:{display:"inline",marginRight:15,fontSize:10,cursor:"default",color:"var(--ant-color-text)"},"data-tauri-drag-region":!0,children:["Created by\xA0",(0,u.jsx)("a",{href:"https://github.com/bismarckkk",target:"_blank",children:(0,u.jsx)(C.ZP,{type:"link",style:{padding:0},size:"small","data-tauri-drag-region":!0,children:"Bismarckkk"})})]}),this.props.darkMode?o:l,(0,u.jsx)("a",{href:"https://github.com/bismarckkk/RM-UI-Designer",target:"_blank",children:(0,u.jsx)(C.ZP,{type:"text",size:"small",children:(0,u.jsx)(Gr.Z,{style:{color:"var(--ant-color-text)"}})})}),(0,u.jsx)(C.ZP,{type:"text",size:"small",onClick:function(){return de.G.minimize()},style:{display:this.tauri?"inline":"none"},children:(0,u.jsx)(Qr.Z,{style:{color:"var(--ant-color-text)"}})}),this.state.fullscreen?a:r,(0,u.jsx)(C.ZP,{type:"text",size:"small",onClick:function(){return(0,vt.J)()},style:{display:this.tauri?"inline":"none"},children:(0,u.jsx)(Vr.Z,{style:{color:"var(--ant-color-text)"}})})]})]}),(0,u.jsx)(Xr,{ref:this.formRef}),(0,u.jsx)(ea,{ref:this.aboutRef}),(0,u.jsx)(ni,{ref:this.generatorRef}),(0,u.jsx)(ba,{ref:this.logDrawerRef}),(0,u.jsx)(Ca,{ref:this.rxDrawerRef}),(0,u.jsx)(ya,{ref:this.serialModalRef}),(0,u.jsx)(sa,{ref:this.modeModalRef})]})}}]),n}(z.Component),mi=pi;function gi(s){return _t(),(0,u.jsx)("div",{})}var yi=gi,xi=m(18253),bi=qe.Z.darkAlgorithm,Ft=qe.Z.compactAlgorithm,Mi=function(s){H()(n,s);var e=P()(n);function n(){var i;I()(this,n);for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return i=e.call.apply(e,[this].concat(r)),b()(w()(i),"state",{simulate:!1,darkMode:i.isBrowserDarkMode(),isMounted:!1}),b()(w()(i),"modal",null),b()(w()(i),"renderRef",z.createRef()),b()(w()(i),"menuRef",z.createRef()),i}return A()(n,[{key:"isBrowserDarkMode",value:function(){try{return window.matchMedia("(prefers-color-scheme: dark)").matches}catch(t){return!1}}},{key:"componentDidMount",value:function(){var t=this,r=this,a=0;window.addEventListener("drop",function(c){return c.preventDefault()},!1),window.addEventListener("dragover",function(c){return c.preventDefault()},!1),window.addEventListener("contextmenu",function(c){c.target.tagName.toLowerCase()!=="input"&&c.preventDefault()},!1);function l(c){!r.modal&&c<880&&c!==a&&(a=c,r.modal=Ie.warning({title:"Display Aera too Small",content:"Cannot show all contents on this window. Please resize this window or rotate your phone.",footer:null,zIndex:2500})),r.modal&&c>=880&&(r.modal.destroy(),r.modal=null)}setTimeout(function(){return l(window.innerWidth)},500),window.addEventListener("resize",function(){l(window.innerWidth)},!1);var o=window.matchMedia("(prefers-color-scheme: dark)");o.addEventListener("change",function(c){r.setState({darkMode:c.matches})}),setTimeout(function(){t.setState({isMounted:!0})},500)}},{key:"setDarkMode",value:function(t){this.setState({darkMode:t})}},{key:"render",value:function(){var t=this;return this.state.isMounted?(0,u.jsx)($t.ZP,{locale:xi.Z,theme:{cssVar:{key:"rmui"},hashed:!1,algorithm:this.state.darkMode?[bi,Ft]:Ft},children:(0,u.jsxs)(_e.Z,{children:[(0,u.jsx)("div",{className:"rmui",children:(0,u.jsxs)("div",{className:"container background-color",style:{height:"100vh",paddingBottom:12,overflow:"hidden"},children:[(0,u.jsx)(mi,{save:function(){return t.renderRef.current.save()},onObjectEvent:function(a,l){return t.renderRef.current.onObjectEvent(a,l)},onHistoryEvent:function(a){return t.renderRef.current.onHistoryEvent(a)},reset:function(){return t.renderRef.current.reset()},setFrame:function(a,l){return t.renderRef.current.onFrameEvent(a,l)},upload:function(a){return t.renderRef.current.upload(a)},getData:function(){return t.renderRef.current.getData()},setEditable:function(a){return t.renderRef.current.setEditable(a)},setDarkMode:function(a){return t.setDarkMode(a)},ref:this.menuRef,darkMode:this.state.darkMode}),(0,u.jsx)(Gt.Z,{content:["RM Ui Designer","nightly 7dc1935"],zIndex:0,style:{height:"100%"},gap:[30,30],children:(0,u.jsx)("div",{id:"content-in",style:{width:"100vw",height:"100%",zIndex:2,position:"relative"},children:(0,u.jsx)(Tr,{style:{width:"100vw",height:"100%"},editable:!0,ref:this.renderRef,onFrameChange:function(a){var l;return(l=t.menuRef.current)===null||l===void 0?void 0:l.setFrames(a)},setCouldDo:function(a){var l;(l=t.menuRef.current)===null||l===void 0||l.setCouldDo(a)},setRobotId:function(a){var l;(l=t.menuRef.current)===null||l===void 0||l.setRobotId(a)}})})})]})}),(0,u.jsx)(yi,{}),(0,u.jsx)(Zr,{}),(0,u.jsx)(Br,{})]})}):(0,u.jsx)(Be.Z,{})}}]),n}(z.Component),wi=Mi}}]);
